<!DOCTYPE html>
<html>
<head>
<title>14. Some More Concepts.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="easy-version--short">Easy Version [ Short ]</h1>
<hr>
<h1 id="%F0%9F%93%9A-fastapi-some-concepts">📚 FastAPI Some Concepts</h1>
<p>This doc is your go-to resource for learning FastAPI’s concurrency, templates, middleware, background tasks, and real-time chat/websocket functionality—complete with code (everywhere!), inline explanations and graph emojis to make important points visually clear! 🚀</p>
<h2 id="%F0%9F%9A%A6-section-1-concurrency-overview">🚦 Section 1: Concurrency Overview</h2>
<h3 id="%F0%9F%93%8A-what-is-concurrency">📊 What is Concurrency?</h3>
<p>Concurrency lets your app handle many requests at once, making everything smoother and faster!</p>
<ul>
<li><strong>Functionality can be asynchronous:</strong><br>
Many operations (like network calls, DB access) don’t need to block others.</li>
<li><strong>We don’t want the execution to block:</strong><br>
<em>Blocking</em> means one slow task pauses everything else 🚫, which is bad for APIs.</li>
</ul>
<h3 id="%E2%9A%A1%EF%B8%8F-pythons-asyncawait">⚡️ Python’s Async/Await</h3>
<ul>
<li><strong><code>async def</code></strong>: Declare a function with suspendable points.</li>
<li><strong><code>await</code></strong>: Pause execution until a task is ready—<em>other requests keep flowing</em>!</li>
</ul>
<h4 id="%E2%9C%8D%EF%B8%8F-code-example">✍️ Code Example</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI

app = FastAPI()

<span class="hljs-meta">@app.get("/concurrent")</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">concurrent_endpoint</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">2</span>)  <span class="hljs-comment"># Pauses here, but server handles other requests!</span>
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"status"</span>: <span class="hljs-string">"Non-blocking, thanks to async!"</span>}
</div></code></pre>
<p><strong>📈 Concurrency boosts QPS (queries-per-second) and reduces user wait!</strong></p>
<h2 id="%F0%9F%8E%A8-section-2-templates">🎨 Section 2: Templates</h2>
<h3 id="%F0%9F%8C%88-what-are-templates">🌈 What are Templates?</h3>
<p>Templates let you render HTML (and inject CSS/JS/variables) on the fly.<br>
<strong>Popular engine:</strong> Jinja2 ⭐</p>
<h4 id="directory-structure">Directory Structure</h4>
<pre class="hljs"><code><div>your_app/
├── templates/
│     └── product.html
├── main.py
</div></code></pre>
<h3 id="%E2%9C%8D%EF%B8%8F-code-example">✍️ Code Example</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Request
<span class="hljs-keyword">from</span> fastapi.templating <span class="hljs-keyword">import</span> Jinja2Templates
<span class="hljs-keyword">from</span> fastapi.responses <span class="hljs-keyword">import</span> HTMLResponse

app = FastAPI()
templates = Jinja2Templates(directory=<span class="hljs-string">"templates"</span>)

<span class="hljs-meta">@app.get("/product/{id}", response_class=HTMLResponse)</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">product_page</span><span class="hljs-params">(id: int, request: Request)</span>:</span>
    <span class="hljs-comment"># 🎨 Pass variables to your HTML</span>
    <span class="hljs-keyword">return</span> templates.TemplateResponse(<span class="hljs-string">"product.html"</span>, {
        <span class="hljs-string">"request"</span>: request,
        <span class="hljs-string">"product_id"</span>: id
    })
</div></code></pre>
<blockquote>
<p>📝 <code>product.html</code> uses Jinja2:<br>
<code>Product {{ product_id }}</code></p>
</blockquote>
<p><strong>📈 Improves user experience with dynamic pages!</strong></p>
<h2 id="%F0%9F%9B%A1%EF%B8%8F-section-3-middleware">🛡️ Section 3: Middleware</h2>
<p>Middleware executes logic <strong>before and after each HTTP request</strong>. Perfect for logging, headers, security, etc.</p>
<h4 id="%F0%9F%93%81-structure">📁 Structure:</h4>
<pre class="hljs"><code><div>├── middleware.py
├── config.py
├── main.py
└── routers/
    └── middleware_demo.py
</div></code></pre>
<h3 id="%F0%9F%A7%A9-example-custom-logging-middleware-with-emojis">🧩 Example: Custom Logging Middleware with Emojis</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> starlette.middleware.base <span class="hljs-keyword">import</span> BaseHTTPMiddleware
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Request

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmojiLoggerMiddleware</span><span class="hljs-params">(BaseHTTPMiddleware)</span>:</span>
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dispatch</span><span class="hljs-params">(self, request: Request, call_next)</span>:</span>
        print(<span class="hljs-string">f"🟢 <span class="hljs-subst">{request.method}</span> <span class="hljs-subst">{request.url}</span>"</span>)
        response = <span class="hljs-keyword">await</span> call_next(request)
        print(<span class="hljs-string">f"🔵 <span class="hljs-subst">{response.status_code}</span> <span class="hljs-subst">{request.url}</span>"</span>)
        <span class="hljs-keyword">return</span> response

app = FastAPI()
app.add_middleware(EmojiLoggerMiddleware)
</div></code></pre>
<h3 id="%F0%9F%A7%B0-other-middleware-features">🧰 Other Middleware Features</h3>
<table>
<thead>
<tr>
<th>Middleware</th>
<th>Emoji</th>
<th>Key Function</th>
</tr>
</thead>
<tbody>
<tr>
<td>Logging</td>
<td>📝</td>
<td>Trace requests (unique IDs, times, errors)</td>
</tr>
<tr>
<td>Rate Limiting</td>
<td>⏳</td>
<td>Prevent abuse (429 if too many reqs)</td>
</tr>
<tr>
<td>Security Headers</td>
<td>🛡️</td>
<td>Prevent XSS, clickjacking, CSP problems</td>
</tr>
<tr>
<td>Error Handling</td>
<td>🪲</td>
<td>Catch &amp; log all exceptions, reply gracefully</td>
</tr>
<tr>
<td>Request Validation</td>
<td>🏷️</td>
<td>Block big/suspicious requests</td>
</tr>
<tr>
<td>Performance Monitor</td>
<td>📈</td>
<td>Log slow APIs, add times to headers</td>
</tr>
<tr>
<td>Authentication</td>
<td>🔒</td>
<td>Checks user identities, protect routes</td>
</tr>
<tr>
<td>CORS</td>
<td>🌍</td>
<td>Let frontends on other origins call you</td>
</tr>
<tr>
<td>GZip Compression</td>
<td>💨</td>
<td>Shrink responses for speed</td>
</tr>
</tbody>
</table>
<h3 id="%F0%9F%9A%80-full-fastapi-middleware-example">🚀 Full FastAPI Middleware Example</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># middleware.py</span>
<span class="hljs-keyword">from</span> starlette.middleware.base <span class="hljs-keyword">import</span> BaseHTTPMiddleware
<span class="hljs-keyword">import</span> time

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TimingMiddleware</span><span class="hljs-params">(BaseHTTPMiddleware)</span>:</span>
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dispatch</span><span class="hljs-params">(self, request, call_next)</span>:</span>
        start = time.time()
        response = <span class="hljs-keyword">await</span> call_next(request)
        duration = time.time() - start
        response.headers[<span class="hljs-string">"X-Process-Time"</span>] = str(duration)
        print(<span class="hljs-string">f"📊 <span class="hljs-subst">{request.url.path}</span> took <span class="hljs-subst">{duration:<span class="hljs-number">.2</span>f}</span>s"</span>)
        <span class="hljs-keyword">return</span> response
</div></code></pre>
<p><strong>Add it in <code>main.py</code>:</strong></p>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI
<span class="hljs-keyword">from</span> middleware <span class="hljs-keyword">import</span> TimingMiddleware

app = FastAPI()
app.add_middleware(TimingMiddleware)
</div></code></pre>
<h2 id="%F0%9F%8F%83-section-4-background-tasks">🏃 Section 4: Background Tasks</h2>
<p>Let your API finish fast while <em>longer work</em> (like sending emails) runs after response.</p>
<h3 id="%E2%9C%8D%EF%B8%8F-example">✍️ Example</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, BackgroundTasks

app = FastAPI()

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_email</span><span class="hljs-params">(to: str)</span>:</span>
    print(<span class="hljs-string">f"📧 Email sent to <span class="hljs-subst">{to}</span>"</span>)

<span class="hljs-meta">@app.post("/signup")</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">signup</span><span class="hljs-params">(email: str, background_tasks: BackgroundTasks)</span>:</span>
    background_tasks.add_task(send_email, email)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"status"</span>: <span class="hljs-string">"Signed up! Email sending in background 👾"</span>}
</div></code></pre>
<ul>
<li><strong>Processing is offloaded!</strong></li>
<li><strong>Client never waits for slow tasks.</strong></li>
</ul>
<h2 id="%F0%9F%92%AC-section-5-real-time-chat-client--websockets">💬 Section 5: Real-Time Chat Client &amp; WebSockets</h2>
<p>WebSockets = <strong>two-way, always-on connection</strong>, ideal for chat, live dashboards, notifications.</p>
<h3 id="%E2%9C%8D%EF%B8%8F-websocket-echo-example">✍️ WebSocket (Echo) Example</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, WebSocket

app = FastAPI()

<span class="hljs-meta">@app.websocket("/ws")</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">chat</span><span class="hljs-params">(websocket: WebSocket)</span>:</span>
    <span class="hljs-keyword">await</span> websocket.accept()
    <span class="hljs-keyword">await</span> websocket.send_text(<span class="hljs-string">"👋 Welcome to chat!"</span>)
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        msg = <span class="hljs-keyword">await</span> websocket.receive_text()
        <span class="hljs-keyword">await</span> websocket.send_text(<span class="hljs-string">f"🗨️ You said: <span class="hljs-subst">{msg}</span>"</span>)
</div></code></pre>
<p><strong>Keep connection open for live info, not just HTTP requests!</strong></p>
<h2 id="%F0%9F%A7%A9-full-middleware-system-example">🧩 Full Middleware System Example</h2>
<p><strong>Config File (<code>config.py</code>):</strong></p>
<pre class="hljs"><code><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Settings</span>:</span>
    CORS_ORIGINS = [<span class="hljs-string">"http://localhost"</span>, <span class="hljs-string">"http://127.0.0.1:8000"</span>]
    RATE_LIMIT_REQUESTS_PER_MINUTE = <span class="hljs-number">100</span>
    MAX_CONTENT_LENGTH = <span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>  <span class="hljs-comment"># 10 MB</span>
    SLOW_REQUEST_THRESHOLD = <span class="hljs-number">1.0</span>           <span class="hljs-comment"># 1 second</span>
    PUBLIC_PATHS = [<span class="hljs-string">"/"</span>, <span class="hljs-string">"/docs"</span>, <span class="hljs-string">"/health"</span>]
</div></code></pre>
<p><strong>Use these in your middleware components to make behaviors configurable!</strong><br>
<strong>Logging, Security, Rate Limit, Performance — all with 📈 and 📉 monitoring.</strong></p>
<h2 id="%F0%9F%93%9D-troubleshooting--quick-testing">📝 Troubleshooting &amp; Quick Testing</h2>
<ul>
<li><strong>Check status:</strong> <code>curl http://127.0.0.1:8000/health</code></li>
<li><strong>Test middleware:</strong> <code>curl http://127.0.0.1:8000/middleware-demo/</code></li>
<li><strong>Swagger interface:</strong> Open http://127.0.0.1:8000/docs ✅</li>
</ul>
<p><strong>Common Issues:</strong></p>
<ul>
<li>Module errors? Check imports.</li>
<li>Port busy? Add <code>--port 8001</code> to your start command.</li>
<li>Rate limiting too strict? Tweak config.</li>
<li>CSP/Docs not loading? Review your security headers for <code>Content-Security-Policy</code>.</li>
</ul>
<h2 id="%F0%9F%93%8A-graph-emoji-reference">📊 Graph Emoji Reference</h2>
<ul>
<li><strong>📈</strong> — Things rising/improving (performance, concurrency)</li>
<li><strong>📉</strong> — Downsides or problems (slowdowns, errors)</li>
<li><strong>📊</strong> — Metrics/data being tracked (requests, timings, rates)</li>
</ul>
<h2 id="%F0%9F%8E%AF-best-practices">🎯 Best Practices</h2>
<ul>
<li>Use <code>async/await</code> for all I/O: <strong>never block</strong> request handling! 📈</li>
<li>Templates separate logic from HTML 🎨</li>
<li>Middleware must be lightweight and error-handling robust 🛡️</li>
<li>Run post-response work as background tasks 🏃</li>
<li>Use WebSockets for real-time, two-way interaction 💬</li>
<li>Add clear emojis to logs for faster problem solving! 😃</li>
</ul>
<hr>
<h1 id="in-depth">In Depth</h1>
<hr>
<h1 id="%F0%9F%9A%80-enhanced-fastapi-comprehensive-guide-advanced-features-flows--real-world-applications">🚀 Enhanced FastAPI Comprehensive Guide: Advanced Features, Flows &amp; Real-World Applications</h1>
<h2 id="%F0%9F%93%8B-table-of-contents-with-visual-flow">📋 Table of Contents with Visual Flow</h2>
<pre class="hljs"><code><div>🏠 Home → 🔄 Concurrency → 🎨 Templates → 🛡️ Middleware → ⚡ Background → 💬 WebSockets → 📊 Monitoring
     ↓         ↓            ↓            ↓             ↓            ↓             ↓
   Setup → Performance → UI/UX → Security → Processing → Real-time → Analytics
</div></code></pre>
<h2 id="%F0%9F%8C%9F-fastapi-architecture-overview">🌟 FastAPI Architecture Overview</h2>
<h3 id="%F0%9F%8F%97%EF%B8%8F-complete-system-flow-diagram">🏗️ Complete System Flow Diagram</h3>
<pre class="hljs"><code><div>📱 Client Request
    ↓
🌐 Load Balancer (nginx)
    ↓
🚪 FastAPI Application Entry Point
    ↓
🛡️ Security Middleware Layer
    ├── 🔒 Authentication Check
    ├── 🚦 Rate Limiting
    ├── 📏 Request Validation
    └── 🛡️ Security Headers
    ↓
📝 Logging &amp; Monitoring Layer
    ├── 📊 Performance Metrics
    ├── 🔍 Request Tracking
    └── 📈 Analytics Collection
    ↓
🎯 Business Logic Layer
    ├── 🔄 Async Processing
    ├── 💾 Database Operations  
    ├── 🌐 External API Calls
    └── 📁 File Operations
    ↓
🎨 Response Layer
    ├── 📄 Template Rendering
    ├── 📊 Data Serialization
    └── 🗜️ Response Compression
    ↓
⚡ Background Tasks (Optional)
    ├── 📧 Email Sending
    ├── 📄 Report Generation
    └── 🧹 Cleanup Operations
    ↓
🌐 Client Response
</div></code></pre>
<h2 id="%F0%9F%94%84-section-1-concurrency--async-programming-deep-dive">🔄 Section 1: Concurrency &amp; Async Programming Deep Dive</h2>
<h3 id="%F0%9F%93%8A-performance-comparison-chart">📊 Performance Comparison Chart</h3>
<pre class="hljs"><code><div>🐌 Synchronous Processing:
Request 1 ████████████████████████████████ 3000ms
Request 2                                 ████████████████████████████████ 3000ms  
Request 3                                                                  ████████████████████████████████ 3000ms
Total Time: 9000ms

⚡ Asynchronous Processing:
Request 1 ████████████████████████████████ 3000ms
Request 2 ████████████████████████████████ 3000ms (concurrent)
Request 3 ████████████████████████████████ 3000ms (concurrent)
Total Time: 3000ms
</div></code></pre>
<h3 id="%F0%9F%8E%AF-concurrency-decision-tree">🎯 Concurrency Decision Tree</h3>
<pre class="hljs"><code><div>📥 Incoming Request
    ↓
❓ Does it involve I/O operations?
    ├── ✅ Yes → Use async/await
    │    ├── 💾 Database queries
    │    ├── 🌐 HTTP requests
    │    ├── 📁 File operations
    │    └── 🕐 Time delays
    └── ❌ No → Sync is fine
         ├── 🧮 CPU calculations
         ├── 📊 Data transformations
         └── 🔢 Mathematical operations
</div></code></pre>
<h3 id="%F0%9F%9B%A0%EF%B8%8F-advanced-async-patterns--use-cases">🛠️ Advanced Async Patterns &amp; Use Cases</h3>
<h4 id="%F0%9F%94%84-pattern-1-concurrent-database-queries">🔄 Pattern 1: Concurrent Database Queries</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> List, Dict, Any

app = FastAPI(title=<span class="hljs-string">"🚀 Async Performance Demo"</span>)

<span class="hljs-comment"># 📊 Performance tracking decorator</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">track_performance</span><span class="hljs-params">(func)</span>:</span>
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">wrapper</span><span class="hljs-params">(*args, **kwargs)</span>:</span>
        start_time = time.time()
        result = <span class="hljs-keyword">await</span> func(*args, **kwargs)
        execution_time = time.time() - start_time
        print(<span class="hljs-string">f"⏱️ <span class="hljs-subst">{func.__name__}</span> executed in <span class="hljs-subst">{execution_time:<span class="hljs-number">.4</span>f}</span>s"</span>)
        <span class="hljs-keyword">return</span> result
    <span class="hljs-keyword">return</span> wrapper

<span class="hljs-meta">@track_performance</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fetch_user_profile</span><span class="hljs-params">(user_id: int)</span> -&gt; Dict[str, Any]:</span>
    <span class="hljs-string">"""🧑 Simulate fetching user profile from database"""</span>
    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">0.1</span>)  <span class="hljs-comment"># Database query simulation</span>
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"id"</span>: user_id,
        <span class="hljs-string">"name"</span>: <span class="hljs-string">f"User <span class="hljs-subst">{user_id}</span>"</span>,
        <span class="hljs-string">"profile"</span>: <span class="hljs-string">f"Profile data for user <span class="hljs-subst">{user_id}</span>"</span>
    }

<span class="hljs-meta">@track_performance</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fetch_user_orders</span><span class="hljs-params">(user_id: int)</span> -&gt; List[Dict[str, Any]]:</span>
    <span class="hljs-string">"""📦 Simulate fetching user orders"""</span>
    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">0.2</span>)  <span class="hljs-comment"># Slower query simulation</span>
    <span class="hljs-keyword">return</span> [
        {<span class="hljs-string">"order_id"</span>: <span class="hljs-string">f"ORD<span class="hljs-subst">{user_id}</span>001"</span>, <span class="hljs-string">"amount"</span>: <span class="hljs-number">99.99</span>},
        {<span class="hljs-string">"order_id"</span>: <span class="hljs-string">f"ORD<span class="hljs-subst">{user_id}</span>002"</span>, <span class="hljs-string">"amount"</span>: <span class="hljs-number">149.50</span>}
    ]

<span class="hljs-meta">@track_performance</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fetch_user_preferences</span><span class="hljs-params">(user_id: int)</span> -&gt; Dict[str, Any]:</span>
    <span class="hljs-string">"""⚙️ Simulate fetching user preferences"""</span>
    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">0.05</span>)  <span class="hljs-comment"># Fast query simulation</span>
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"theme"</span>: <span class="hljs-string">"dark"</span>,
        <span class="hljs-string">"notifications"</span>: <span class="hljs-literal">True</span>,
        <span class="hljs-string">"language"</span>: <span class="hljs-string">"en"</span>
    }

<span class="hljs-meta">@app.get("/user/{user_id}/dashboard")</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_user_dashboard</span><span class="hljs-params">(user_id: int)</span>:</span>
    <span class="hljs-string">"""
    📊 Fetch all user data concurrently for dashboard
    
    Use Case: User dashboard that needs multiple data sources
    ✅ Perfect for: E-commerce, social media, admin panels
    📈 Performance gain: 70% faster than sequential queries
    """</span>
    <span class="hljs-comment"># 🚀 Execute all queries concurrently</span>
    profile_task = fetch_user_profile(user_id)
    orders_task = fetch_user_orders(user_id)
    preferences_task = fetch_user_preferences(user_id)
    
    <span class="hljs-comment"># ⏳ Wait for all tasks to complete</span>
    profile, orders, preferences = <span class="hljs-keyword">await</span> asyncio.gather(
        profile_task,
        orders_task,
        preferences_task
    )
    
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"user_profile"</span>: profile,
        <span class="hljs-string">"recent_orders"</span>: orders,
        <span class="hljs-string">"preferences"</span>: preferences,
        <span class="hljs-string">"dashboard_loaded_at"</span>: time.time()
    }
</div></code></pre>
<h4 id="%F0%9F%8C%90-pattern-2-external-api-integration">🌐 Pattern 2: External API Integration</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> httpx
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> HTTPException

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExternalAPIManager</span>:</span>
    <span class="hljs-string">"""🌐 Manager for handling multiple external APIs concurrently"""</span>
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
        self.timeout = httpx.Timeout(<span class="hljs-number">30.0</span>)
    
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fetch_weather</span><span class="hljs-params">(self, city: str)</span> -&gt; Dict[str, Any]:</span>
        <span class="hljs-string">"""🌤️ Fetch weather data"""</span>
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> httpx.AsyncClient(timeout=self.timeout) <span class="hljs-keyword">as</span> client:
            <span class="hljs-keyword">try</span>:
                response = <span class="hljs-keyword">await</span> client.get(
                    <span class="hljs-string">f"https://api.weatherapi.com/v1/current.json?key=YOUR_KEY&amp;q=<span class="hljs-subst">{city}</span>"</span>
                )
                response.raise_for_status()
                <span class="hljs-keyword">return</span> response.json()
            <span class="hljs-keyword">except</span> httpx.RequestError <span class="hljs-keyword">as</span> e:
                print(<span class="hljs-string">f"🌐 Weather API error: <span class="hljs-subst">{e}</span>"</span>)
                <span class="hljs-keyword">return</span> {<span class="hljs-string">"error"</span>: <span class="hljs-string">"Weather service unavailable"</span>}
    
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fetch_news</span><span class="hljs-params">(self, category: str)</span> -&gt; Dict[str, Any]:</span>
        <span class="hljs-string">"""📰 Fetch news data"""</span>
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> httpx.AsyncClient(timeout=self.timeout) <span class="hljs-keyword">as</span> client:
            <span class="hljs-keyword">try</span>:
                response = <span class="hljs-keyword">await</span> client.get(
                    <span class="hljs-string">f"https://newsapi.org/v2/top-headlines?category=<span class="hljs-subst">{category}</span>&amp;apiKey=YOUR_KEY"</span>
                )
                response.raise_for_status()
                <span class="hljs-keyword">return</span> response.json()
            <span class="hljs-keyword">except</span> httpx.RequestError <span class="hljs-keyword">as</span> e:
                print(<span class="hljs-string">f"📰 News API error: <span class="hljs-subst">{e}</span>"</span>)
                <span class="hljs-keyword">return</span> {<span class="hljs-string">"error"</span>: <span class="hljs-string">"News service unavailable"</span>}
    
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fetch_stock_data</span><span class="hljs-params">(self, symbol: str)</span> -&gt; Dict[str, Any]:</span>
        <span class="hljs-string">"""📈 Fetch stock market data"""</span>
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> httpx.AsyncClient(timeout=self.timeout) <span class="hljs-keyword">as</span> client:
            <span class="hljs-keyword">try</span>:
                response = <span class="hljs-keyword">await</span> client.get(
                    <span class="hljs-string">f"https://api.alphavantage.co/query?function=GLOBAL_QUOTE&amp;symbol=<span class="hljs-subst">{symbol}</span>&amp;apikey=YOUR_KEY"</span>
                )
                response.raise_for_status()
                <span class="hljs-keyword">return</span> response.json()
            <span class="hljs-keyword">except</span> httpx.RequestError <span class="hljs-keyword">as</span> e:
                print(<span class="hljs-string">f"📈 Stock API error: <span class="hljs-subst">{e}</span>"</span>)
                <span class="hljs-keyword">return</span> {<span class="hljs-string">"error"</span>: <span class="hljs-string">"Stock service unavailable"</span>}

api_manager = ExternalAPIManager()

<span class="hljs-meta">@app.get("/dashboard/{city}")</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_comprehensive_dashboard</span><span class="hljs-params">(city: str, stock_symbol: str = <span class="hljs-string">"AAPL"</span>)</span>:</span>
    <span class="hljs-string">"""
    🎯 Comprehensive dashboard with multiple external APIs
    
    Use Cases:
    📊 Financial trading platforms
    📱 Personal assistant apps  
    🏢 Business intelligence dashboards
    🎯 Real-time monitoring systems
    """</span>
    
    <span class="hljs-comment"># 🚀 Execute all external API calls concurrently</span>
    weather_task = api_manager.fetch_weather(city)
    news_task = api_manager.fetch_news(<span class="hljs-string">"technology"</span>)
    stock_task = api_manager.fetch_stock_data(stock_symbol)
    
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># ⏳ Gather results with timeout protection</span>
        weather, news, stocks = <span class="hljs-keyword">await</span> asyncio.wait_for(
            asyncio.gather(weather_task, news_task, stock_task),
            timeout=<span class="hljs-number">10.0</span>  <span class="hljs-comment"># 10 second timeout</span>
        )
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"location"</span>: city,
            <span class="hljs-string">"weather"</span>: weather,
            <span class="hljs-string">"news"</span>: news,
            <span class="hljs-string">"stocks"</span>: stocks,
            <span class="hljs-string">"status"</span>: <span class="hljs-string">"✅ All services responding"</span>,
            <span class="hljs-string">"loaded_at"</span>: time.time()
        }
        
    <span class="hljs-keyword">except</span> asyncio.TimeoutError:
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"error"</span>: <span class="hljs-string">"⏰ Dashboard load timeout"</span>,
            <span class="hljs-string">"status"</span>: <span class="hljs-string">"⚠️ Some services may be slow"</span>,
            <span class="hljs-string">"location"</span>: city
        }
</div></code></pre>
<h4 id="%F0%9F%93%8A-pattern-3-batch-processing">📊 Pattern 3: Batch Processing</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Optional
<span class="hljs-keyword">import</span> uuid

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AsyncBatchProcessor</span>:</span>
    <span class="hljs-string">"""📦 Process multiple items concurrently with progress tracking"""</span>
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, batch_size: int = <span class="hljs-number">10</span>)</span>:</span>
        self.batch_size = batch_size
        self.processing_jobs = {}
    
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process_item</span><span class="hljs-params">(self, item_id: str, data: Dict[str, Any])</span> -&gt; Dict[str, Any]:</span>
        <span class="hljs-string">"""🔄 Process individual item (simulate heavy computation)"""</span>
        <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">0.5</span>)  <span class="hljs-comment"># Simulate processing time</span>
        
        <span class="hljs-comment"># Simulate some processing logic</span>
        processed_data = {
            <span class="hljs-string">"original_id"</span>: item_id,
            <span class="hljs-string">"processed_at"</span>: time.time(),
            <span class="hljs-string">"result"</span>: <span class="hljs-string">f"Processed: <span class="hljs-subst">{data.get(<span class="hljs-string">'name'</span>, <span class="hljs-string">'unknown'</span>)}</span>"</span>,
            <span class="hljs-string">"status"</span>: <span class="hljs-string">"✅ completed"</span>
        }
        
        <span class="hljs-keyword">return</span> processed_data
    
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">batch_process</span><span class="hljs-params">(self, items: List[Dict[str, Any]])</span> -&gt; Dict[str, Any]:</span>
        <span class="hljs-string">"""📦 Process items in batches"""</span>
        job_id = str(uuid.uuid4())
        
        <span class="hljs-comment"># 📊 Track processing job</span>
        self.processing_jobs[job_id] = {
            <span class="hljs-string">"status"</span>: <span class="hljs-string">"🔄 processing"</span>,
            <span class="hljs-string">"total_items"</span>: len(items),
            <span class="hljs-string">"completed_items"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"started_at"</span>: time.time()
        }
        
        results = []
        
        <span class="hljs-comment"># 📦 Process in batches to avoid overwhelming the system</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>, len(items), self.batch_size):
            batch = items[i:i + self.batch_size]
            
            <span class="hljs-comment"># 🚀 Process batch concurrently</span>
            batch_tasks = [
                self.process_item(<span class="hljs-string">f"item_<span class="hljs-subst">{i+j}</span>"</span>, item) 
                <span class="hljs-keyword">for</span> j, item <span class="hljs-keyword">in</span> enumerate(batch)
            ]
            
            batch_results = <span class="hljs-keyword">await</span> asyncio.gather(*batch_tasks)
            results.extend(batch_results)
            
            <span class="hljs-comment"># 📊 Update progress</span>
            self.processing_jobs[job_id][<span class="hljs-string">"completed_items"</span>] = len(results)
        
        <span class="hljs-comment"># ✅ Mark job as completed</span>
        self.processing_jobs[job_id][<span class="hljs-string">"status"</span>] = <span class="hljs-string">"✅ completed"</span>
        self.processing_jobs[job_id][<span class="hljs-string">"completed_at"</span>] = time.time()
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"job_id"</span>: job_id,
            <span class="hljs-string">"results"</span>: results,
            <span class="hljs-string">"summary"</span>: {
                <span class="hljs-string">"total_processed"</span>: len(results),
                <span class="hljs-string">"processing_time"</span>: time.time() - self.processing_jobs[job_id][<span class="hljs-string">"started_at"</span>]
            }
        }

batch_processor = AsyncBatchProcessor()

<span class="hljs-meta">@app.post("/batch-process")</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start_batch_processing</span><span class="hljs-params">(items: List[Dict[str, Any]])</span>:</span>
    <span class="hljs-string">"""
    📦 Start batch processing of items
    
    Use Cases:
    📊 Data migration and ETL processes
    📄 Bulk document processing
    🖼️ Image/video processing pipelines
    📧 Mass email campaigns
    🧹 Database maintenance tasks
    """</span>
    
    <span class="hljs-keyword">if</span> len(items) &gt; <span class="hljs-number">100</span>:
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"error"</span>: <span class="hljs-string">"🚫 Too many items"</span>,
            <span class="hljs-string">"max_allowed"</span>: <span class="hljs-number">100</span>,
            <span class="hljs-string">"submitted"</span>: len(items)
        }
    
    result = <span class="hljs-keyword">await</span> batch_processor.batch_process(items)
    
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"message"</span>: <span class="hljs-string">"📦 Batch processing completed"</span>,
        <span class="hljs-string">"result"</span>: result
    }

<span class="hljs-meta">@app.get("/batch-job/{job_id}")</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_batch_job_status</span><span class="hljs-params">(job_id: str)</span>:</span>
    <span class="hljs-string">"""📊 Get batch processing job status"""</span>
    
    <span class="hljs-keyword">if</span> job_id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> batch_processor.processing_jobs:
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">"🔍 Job not found"</span>)
    
    <span class="hljs-keyword">return</span> batch_processor.processing_jobs[job_id]
</div></code></pre>
<h3 id="%F0%9F%93%88-concurrency-use-cases--performance-metrics">📈 Concurrency Use Cases &amp; Performance Metrics</h3>
<table>
<thead>
<tr>
<th style="text-align:left">Use Case</th>
<th style="text-align:left">🐌 Sync Time</th>
<th style="text-align:left">⚡ Async Time</th>
<th style="text-align:left">📊 Improvement</th>
<th style="text-align:left">Best For</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">User Dashboard</td>
<td style="text-align:left">850ms</td>
<td style="text-align:left">280ms</td>
<td style="text-align:left">📈 67% faster</td>
<td style="text-align:left">E-commerce, Social Media</td>
</tr>
<tr>
<td style="text-align:left">API Aggregation</td>
<td style="text-align:left">1200ms</td>
<td style="text-align:left">320ms</td>
<td style="text-align:left">📈 73% faster</td>
<td style="text-align:left">Data Analytics, Reporting</td>
</tr>
<tr>
<td style="text-align:left">Batch Processing</td>
<td style="text-align:left">45s</td>
<td style="text-align:left">12s</td>
<td style="text-align:left">📈 73% faster</td>
<td style="text-align:left">ETL, Data Migration</td>
</tr>
<tr>
<td style="text-align:left">File Processing</td>
<td style="text-align:left">2.3s</td>
<td style="text-align:left">0.8s</td>
<td style="text-align:left">📈 65% faster</td>
<td style="text-align:left">Document Management</td>
</tr>
<tr>
<td style="text-align:left">Email Campaigns</td>
<td style="text-align:left">15min</td>
<td style="text-align:left">4min</td>
<td style="text-align:left">📈 73% faster</td>
<td style="text-align:left">Marketing, Notifications</td>
</tr>
</tbody>
</table>
<h2 id="%F0%9F%8E%A8-section-2-advanced-template-system-with-dynamic-components">🎨 Section 2: Advanced Template System with Dynamic Components</h2>
<h3 id="%F0%9F%8F%97%EF%B8%8F-template-architecture-flow">🏗️ Template Architecture Flow</h3>
<pre class="hljs"><code><div>📄 Base Template (base.html)
    ├── 🧩 Header Component
    │   ├── 🧭 Navigation
    │   ├── 👤 User Menu
    │   └── 🔍 Search Bar
    ├── 📱 Main Content Area
    │   ├── 🎯 Dynamic Content Blocks
    │   ├── 📊 Data Visualizations
    │   └── 🎨 Interactive Elements
    ├── 🦶 Footer Component
    │   ├── 🔗 Links
    │   ├── 📞 Contact Info
    │   └── 📱 Social Media
    └── ⚡ JavaScript Assets
        ├── 🎨 UI Interactions
        ├── 📡 AJAX Calls
        └── 📊 Real-time Updates
</div></code></pre>
<h3 id="%F0%9F%9B%A0%EF%B8%8F-enhanced-template-implementation">🛠️ Enhanced Template Implementation</h3>
<h4 id="%F0%9F%93%84-advanced-base-template">📄 Advanced Base Template</h4>
<pre class="hljs"><code><div><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span> <span class="hljs-attr">data-theme</span>=<span class="hljs-string">"{% block theme %}light{% endblock %}"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"description"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"{% block meta_description %}FastAPI Application{% endblock %}"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"keywords"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"{% block meta_keywords %}fastapi, python, web, api{% endblock %}"</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 🎨 Dynamic Title --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>{% block title %}FastAPI App{% endblock %} | 🚀 Modern Web Platform<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 🎨 Favicon and Icons --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"icon"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/svg+xml"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/static/favicon.svg"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"icon"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/png"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/static/favicon.png"</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 🎨 CSS Framework and Custom Styles --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/static/styles.css"</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 📱 Progressive Web App --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"manifest"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/static/manifest.json"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"theme-color"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"#4f46e5"</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 📊 Analytics --&gt;</span>
    {% block analytics %}{% endblock %}
    
    <span class="hljs-comment">&lt;!-- 🎨 Custom Page Styles --&gt;</span>
    {% block extra_css %}{% endblock %}
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"{% block body_class %}bg-gray-50{% endblock %}"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 🔄 Loading Spinner --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"global-loader"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fixed inset-0 bg-white z-50 flex items-center justify-center"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ml-4 text-lg"</span>&gt;</span>🚀 Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 🧭 Navigation Header --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bg-white shadow-lg sticky top-0 z-40"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex justify-between items-center h-16"</span>&gt;</span>
                <span class="hljs-comment">&lt;!-- 🏠 Logo --&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex items-center"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex items-center space-x-2"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-2xl"</span>&gt;</span>🚀<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-xl font-bold text-gray-900"</span>&gt;</span>FastAPI<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                
                <span class="hljs-comment">&lt;!-- 🧭 Navigation Links --&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"hidden md:block"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ml-10 flex items-baseline space-x-4"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link {% block nav_home %}{% endblock %}"</span>&gt;</span>🏠 Home<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/docs"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link {% block nav_docs %}{% endblock %}"</span>&gt;</span>📚 API Docs<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/templates/dashboard"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link {% block nav_dashboard %}{% endblock %}"</span>&gt;</span>📊 Dashboard<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/templates/products/1"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link {% block nav_products %}{% endblock %}"</span>&gt;</span>📦 Products<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                
                <span class="hljs-comment">&lt;!-- 👤 User Menu --&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex items-center space-x-4"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"theme-toggle"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"p-2 rounded-md hover:bg-gray-100"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"theme-icon"</span>&gt;</span>🌙<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"relative"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex items-center space-x-2 p-2 rounded-md hover:bg-gray-100"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>👤<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>User<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 📢 Notification Area --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"notifications"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fixed top-20 right-4 z-50 space-y-2"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 📱 Main Content --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">main</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"{% block main_class %}max-w-7xl mx-auto py-6 sm:px-6 lg:px-8{% endblock %}"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 🎯 Breadcrumb --&gt;</span>
        {% block breadcrumb %}{% endblock %}
        
        <span class="hljs-comment">&lt;!-- 📊 Page Header --&gt;</span>
        {% block page_header %}{% endblock %}
        
        <span class="hljs-comment">&lt;!-- 📄 Main Content --&gt;</span>
        {% block content %}{% endblock %}
    <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 🦶 Footer --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">footer</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bg-gray-800 text-white"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"grid grid-cols-1 md:grid-cols-4 gap-8"</span>&gt;</span>
                <span class="hljs-comment">&lt;!-- 🏢 Company Info --&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-lg font-semibold mb-4"</span>&gt;</span>🚀 FastAPI Platform<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-gray-300"</span>&gt;</span>Modern web applications with Python<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                
                <span class="hljs-comment">&lt;!-- 🔗 Quick Links --&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-lg font-semibold mb-4"</span>&gt;</span>📋 Quick Links<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"space-y-2"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/docs"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-gray-300 hover:text-white"</span>&gt;</span>📚 Documentation<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/health"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-gray-300 hover:text-white"</span>&gt;</span>🏥 Health Check<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/metrics"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-gray-300 hover:text-white"</span>&gt;</span>📊 Metrics<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                
                <span class="hljs-comment">&lt;!-- 🛠️ Resources --&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-lg font-semibold mb-4"</span>&gt;</span>🛠️ Resources<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"space-y-2"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-gray-300 hover:text-white"</span>&gt;</span>📖 Tutorials<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-gray-300 hover:text-white"</span>&gt;</span>🎓 Examples<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-gray-300 hover:text-white"</span>&gt;</span>🤝 Community<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                
                <span class="hljs-comment">&lt;!-- 📱 Connect --&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-lg font-semibold mb-4"</span>&gt;</span>📱 Connect<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex space-x-4"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-2xl hover:text-blue-400"</span>&gt;</span>📘<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-2xl hover:text-blue-400"</span>&gt;</span>🐦<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-2xl hover:text-orange-400"</span>&gt;</span>📷<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-2xl hover:text-blue-600"</span>&gt;</span>💼<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"border-t border-gray-700 mt-8 pt-8 text-center"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-gray-300"</span>&gt;</span><span class="hljs-symbol">&amp;copy;</span> 2024 FastAPI Platform. Built with ❤️ and Python<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- ⚡ JavaScript Libraries --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"</span> <span class="hljs-attr">defer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/scripts.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 🎨 Custom Page Scripts --&gt;</span>
    {% block extra_js %}{% endblock %}
    
    <span class="hljs-comment">&lt;!-- 🚀 App Initialization --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// Hide loader when page loads</span>
        <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'load'</span>, () =&gt; {
            <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'global-loader'</span>).style.display = <span class="hljs-string">'none'</span>;
        });
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</div></code></pre>
<h4 id="%F0%9F%93%8A-interactive-dashboard-template">📊 Interactive Dashboard Template</h4>
<pre class="hljs"><code><div>{% extends "base.html" %}

{% block title %}📊 Analytics Dashboard{% endblock %}
{% block nav_dashboard %}bg-blue-100 text-blue-700{% endblock %}

{% block extra_css %}
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.css"</span>&gt;</span>
{% endblock %}

{% block content %}
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"space-y-6"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 📊 Dashboard Header --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg p-6"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-3xl font-bold"</span>&gt;</span>📊 Analytics Dashboard<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mt-2 text-blue-100"</span>&gt;</span>Real-time insights and performance metrics<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mt-4 flex items-center space-x-4"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex items-center"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"w-3 h-3 bg-green-400 rounded-full mr-2"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>All Systems Operational<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-blue-100"</span>&gt;</span>Last Updated: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"last-updated"</span>&gt;</span>{{ current_time }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 📈 Metrics Cards --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"grid grid-cols-1 md:grid-cols-4 gap-6"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"metric-card"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex items-center justify-between"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-sm font-medium text-gray-500"</span>&gt;</span>Total Users<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-3xl font-bold text-gray-900"</span>&gt;</span>{{ metrics.total_users }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-4xl"</span>&gt;</span>👥<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mt-4"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-green-600 text-sm font-medium"</span>&gt;</span>📈 +12% from last month<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"metric-card"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex items-center justify-between"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-sm font-medium text-gray-500"</span>&gt;</span>API Requests<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-3xl font-bold text-gray-900"</span>&gt;</span>{{ metrics.api_requests }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-4xl"</span>&gt;</span>🚀<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mt-4"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-blue-600 text-sm font-medium"</span>&gt;</span>📊 {{ metrics.requests_per_second }}/sec<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"metric-card"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex items-center justify-between"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-sm font-medium text-gray-500"</span>&gt;</span>Response Time<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-3xl font-bold text-gray-900"</span>&gt;</span>{{ metrics.avg_response_time }}ms<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-4xl"</span>&gt;</span>⚡<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mt-4"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-green-600 text-sm font-medium"</span>&gt;</span>⚡ -15ms from yesterday<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"metric-card"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex items-center justify-between"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-sm font-medium text-gray-500"</span>&gt;</span>Success Rate<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-3xl font-bold text-gray-900"</span>&gt;</span>{{ metrics.success_rate }}%<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-4xl"</span>&gt;</span>✅<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mt-4"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-green-600 text-sm font-medium"</span>&gt;</span>🎯 Above 99% target<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 📊 Charts Section --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"grid grid-cols-1 lg:grid-cols-2 gap-6"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 📈 Performance Chart --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chart-container"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chart-header"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-lg font-semibold text-gray-900"</span>&gt;</span>📈 Performance Trends<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chart-controls"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chart-control active"</span> <span class="hljs-attr">data-period</span>=<span class="hljs-string">"24h"</span>&gt;</span>24H<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chart-control"</span> <span class="hljs-attr">data-period</span>=<span class="hljs-string">"7d"</span>&gt;</span>7D<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chart-control"</span> <span class="hljs-attr">data-period</span>=<span class="hljs-string">"30d"</span>&gt;</span>30D<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"performanceChart"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"200"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 🍰 Usage Distribution --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chart-container"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chart-header"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-lg font-semibold text-gray-900"</span>&gt;</span>🍰 Endpoint Usage<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"usageChart"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"200"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 📊 Real-time Activity --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bg-white rounded-lg shadow-lg p-6"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex items-center justify-between mb-6"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-lg font-semibold text-gray-900"</span>&gt;</span>🔄 Real-time Activity<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex items-center space-x-2"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"w-3 h-3 bg-green-400 rounded-full animate-pulse"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-sm text-gray-500"</span>&gt;</span>Live<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"activity-feed"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"space-y-3 max-h-400 overflow-y-auto"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- Real-time activity items will be inserted here --&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
{% endblock %}

{% block extra_js %}
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-comment">// 📊 Initialize Dashboard Charts</span>
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DashboardManager</span> </span>{
        <span class="hljs-keyword">constructor</span>() {
            <span class="hljs-keyword">this</span>.initCharts();
            <span class="hljs-keyword">this</span>.startRealTimeUpdates();
        }
        
        initCharts() {
            <span class="hljs-comment">// 📈 Performance Chart</span>
            <span class="hljs-keyword">const</span> performanceCtx = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'performanceChart'</span>).getContext(<span class="hljs-string">'2d'</span>);
            <span class="hljs-keyword">this</span>.performanceChart = <span class="hljs-keyword">new</span> Chart(performanceCtx, {
                <span class="hljs-attr">type</span>: <span class="hljs-string">'line'</span>,
                <span class="hljs-attr">data</span>: {
                    <span class="hljs-attr">labels</span>: {{ chart_data.performance_labels | tojsonfilter }},
                    <span class="hljs-attr">datasets</span>: [{
                        <span class="hljs-attr">label</span>: <span class="hljs-string">'⚡ Response Time (ms)'</span>,
                        <span class="hljs-attr">data</span>: {{ chart_data.performance_data | tojsonfilter }},
                        <span class="hljs-attr">borderColor</span>: <span class="hljs-string">'rgb(59, 130, 246)'</span>,
                        <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'rgba(59, 130, 246, 0.1)'</span>,
                        <span class="hljs-attr">tension</span>: <span class="hljs-number">0.4</span>
                    }]
                },
                <span class="hljs-attr">options</span>: {
                    <span class="hljs-attr">responsive</span>: <span class="hljs-literal">true</span>,
                    <span class="hljs-attr">plugins</span>: {
                        <span class="hljs-attr">legend</span>: { <span class="hljs-attr">display</span>: <span class="hljs-literal">true</span> }
                    }
                }
            });
            
            <span class="hljs-comment">// 🍰 Usage Chart</span>
            <span class="hljs-keyword">const</span> usageCtx = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'usageChart'</span>).getContext(<span class="hljs-string">'2d'</span>);
            <span class="hljs-keyword">this</span>.usageChart = <span class="hljs-keyword">new</span> Chart(usageCtx, {
                <span class="hljs-attr">type</span>: <span class="hljs-string">'doughnut'</span>,
                <span class="hljs-attr">data</span>: {
                    <span class="hljs-attr">labels</span>: {{ chart_data.usage_labels | tojsonfilter }},
                    <span class="hljs-attr">datasets</span>: [{
                        <span class="hljs-attr">data</span>: {{ chart_data.usage_data | tojsonfilter }},
                        <span class="hljs-attr">backgroundColor</span>: [
                            <span class="hljs-string">'#EF4444'</span>, <span class="hljs-string">'#F59E0B'</span>, <span class="hljs-string">'#10B981'</span>, <span class="hljs-string">'#3B82F6'</span>, <span class="hljs-string">'#8B5CF6'</span>
                        ]
                    }]
                }
            });
        }
        
        startRealTimeUpdates() {
            <span class="hljs-comment">// 🔄 WebSocket connection for real-time updates</span>
            <span class="hljs-keyword">const</span> ws = <span class="hljs-keyword">new</span> WebSocket(<span class="hljs-string">`ws://<span class="hljs-subst">${<span class="hljs-built_in">window</span>.location.host}</span>/ws/dashboard`</span>);
            
            ws.onmessage = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
                <span class="hljs-keyword">const</span> data = <span class="hljs-built_in">JSON</span>.parse(event.data);
                <span class="hljs-keyword">this</span>.updateMetrics(data);
                <span class="hljs-keyword">this</span>.addActivityItem(data.activity);
            };
        }
        
        updateMetrics(data) {
            <span class="hljs-comment">// 🔄 Update metric cards</span>
            <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'[data-metric="requests"]'</span>).textContent = data.requests;
            <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'[data-metric="response-time"]'</span>).textContent = data.responseTime + <span class="hljs-string">'ms'</span>;
        }
        
        addActivityItem(activity) {
            <span class="hljs-keyword">const</span> feed = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'activity-feed'</span>);
            <span class="hljs-keyword">const</span> item = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
            item.className = <span class="hljs-string">'activity-item'</span>;
            item.innerHTML = <span class="hljs-string">`
                &lt;div class="flex items-center space-x-3"&gt;
                    &lt;span class="text-2xl"&gt;<span class="hljs-subst">${activity.icon}</span>&lt;/span&gt;
                    &lt;div&gt;
                        &lt;p class="text-sm font-medium"&gt;<span class="hljs-subst">${activity.message}</span>&lt;/p&gt;
                        &lt;p class="text-xs text-gray-500"&gt;<span class="hljs-subst">${activity.timestamp}</span>&lt;/p&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            `</span>;
            feed.prepend(item);
            
            <span class="hljs-comment">// Keep only last 20 items</span>
            <span class="hljs-keyword">while</span> (feed.children.length &gt; <span class="hljs-number">20</span>) {
                feed.removeChild(feed.lastChild);
            }
        }
    }
    
    <span class="hljs-comment">// 🚀 Initialize dashboard when page loads</span>
    <span class="hljs-built_in">document</span>.addEventListener(<span class="hljs-string">'DOMContentLoaded'</span>, () =&gt; {
        <span class="hljs-keyword">new</span> DashboardManager();
    });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
{% endblock %}
</div></code></pre>
<h3 id="%F0%9F%8E%AF-template-use-cases--applications">🎯 Template Use Cases &amp; Applications</h3>
<table>
<thead>
<tr>
<th style="text-align:left">Template Type</th>
<th style="text-align:left">📊 Use Case</th>
<th style="text-align:left">🏢 Industry</th>
<th style="text-align:left">📱 Features</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Dashboard</td>
<td style="text-align:left">📈 Analytics, KPI Tracking</td>
<td style="text-align:left">SaaS, E-commerce</td>
<td style="text-align:left">Real-time charts, metrics</td>
</tr>
<tr>
<td style="text-align:left">E-commerce</td>
<td style="text-align:left">🛒 Product listings, checkout</td>
<td style="text-align:left">Retail, Marketplace</td>
<td style="text-align:left">Cart, payments, reviews</td>
</tr>
<tr>
<td style="text-align:left">Blog</td>
<td style="text-align:left">📝 Content management</td>
<td style="text-align:left">Media, Education</td>
<td style="text-align:left">Comments, search, categories</td>
</tr>
<tr>
<td style="text-align:left">Admin Panel</td>
<td style="text-align:left">⚙️ System management</td>
<td style="text-align:left">All industries</td>
<td style="text-align:left">User management, settings</td>
</tr>
<tr>
<td style="text-align:left">Landing Page</td>
<td style="text-align:left">🎯 Marketing, conversions</td>
<td style="text-align:left">Marketing, Startups</td>
<td style="text-align:left">Lead capture, testimonials</td>
</tr>
</tbody>
</table>
<h2 id="%F0%9F%9B%A1%EF%B8%8F-section-3-advanced-middleware-system-with-security--performance">🛡️ Section 3: Advanced Middleware System with Security &amp; Performance</h2>
<h3 id="%F0%9F%8F%97%EF%B8%8F-middleware-processing-flow">🏗️ Middleware Processing Flow</h3>
<pre class="hljs"><code><div>🌐 Incoming Request
    ↓
🛡️ [^1] Security Middleware
    ├── 🔒 HTTPS Redirect
    ├── 🛡️ Security Headers  
    ├── 🚫 Block Malicious IPs
    └── 📋 CSP Validation
    ↓
🚦 [^2] Rate Limiting Middleware  
    ├── 📊 Check Request Count
    ├── ⏰ Time Window Analysis
    ├── 🔍 IP-based Limiting
    └── 🚫 Block/Allow Decision
    ↓
📝 [^3] Logging Middleware
    ├── 🆔 Generate Request ID
    ├── 📊 Start Performance Timer
    ├── 📝 Log Request Details
    └── 🔗 Context Propagation
    ↓
🔍 [^4] Request Validation Middleware
    ├── 📏 Content-Length Check
    ├── 🔍 Header Validation
    ├── 📄 Content-Type Check
    └── 🚨 Malicious Content Detection
    ↓
🔐 [^5] Authentication Middleware
    ├── 🔑 Token Validation
    ├── 👤 User Identity
    ├── 🎯 Permission Check
    └── 🚪 Access Control
    ↓
🎯 [^6] Your Business Logic
    ├── 💾 Database Operations
    ├── 🧮 Data Processing  
    ├── 🌐 External API Calls
    └── 📊 Response Generation
    ↓
📊 [^7] Response Processing
    ├── 🗜️ Compression
    ├── 📋 Header Addition
    ├── 🎨 Template Rendering
    └── 📈 Metrics Collection
    ↓
🌐 Outgoing Response
</div></code></pre>
<h3 id="%F0%9F%9B%A0%EF%B8%8F-enhanced-middleware-implementations">🛠️ Enhanced Middleware Implementations</h3>
<h4 id="%F0%9F%9B%A1%EF%B8%8F-advanced-security-middleware">🛡️ Advanced Security Middleware</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> re
<span class="hljs-keyword">import</span> ipaddress
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Set, List, Dict, Any
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Request, Response, HTTPException
<span class="hljs-keyword">from</span> starlette.middleware.base <span class="hljs-keyword">import</span> BaseHTTPMiddleware
<span class="hljs-keyword">import</span> logging

logger = logging.getLogger(__name__)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdvancedSecurityMiddleware</span><span class="hljs-params">(BaseHTTPMiddleware)</span>:</span>
    <span class="hljs-string">"""
    🛡️ Comprehensive security middleware with multiple protection layers
    
    Features:
    🔒 HTTPS enforcement
    🚫 Malicious IP blocking  
    📋 Advanced CSP policies
    🛡️ Security headers
    🚨 Threat detection
    📊 Security analytics
    """</span>
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, app, config: Dict[str, Any])</span>:</span>
        super().__init__(app)
        self.config = config
        self.blocked_ips: Set[str] = set()
        self.suspicious_patterns = [
            <span class="hljs-string">r'&lt;script.*?&gt;.*?&lt;/script&gt;'</span>,  <span class="hljs-comment"># XSS attempts</span>
            <span class="hljs-string">r'union\s+select'</span>,           <span class="hljs-comment"># SQL injection</span>
            <span class="hljs-string">r'\.\./'</span>,                    <span class="hljs-comment"># Directory traversal</span>
            <span class="hljs-string">r'eval\s*\('</span>,               <span class="hljs-comment"># Code injection</span>
        ]
        self.threat_scores: Dict[str, int] = {}  <span class="hljs-comment"># IP -&gt; threat score</span>
    
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dispatch</span><span class="hljs-params">(self, request: Request, call_next)</span> -&gt; Response:</span>
        client_ip = self.get_client_ip(request)
        
        <span class="hljs-comment"># 🚫 Check if IP is blocked</span>
        <span class="hljs-keyword">if</span> client_ip <span class="hljs-keyword">in</span> self.blocked_ips:
            logger.warning(<span class="hljs-string">f"🚫 Blocked IP attempted access: <span class="hljs-subst">{client_ip}</span>"</span>)
            <span class="hljs-keyword">return</span> Response(<span class="hljs-string">"Access Denied"</span>, status_code=<span class="hljs-number">403</span>)
        
        <span class="hljs-comment"># 🔒 Enforce HTTPS in production</span>
        <span class="hljs-keyword">if</span> self.config.get(<span class="hljs-string">"enforce_https"</span>) <span class="hljs-keyword">and</span> request.url.scheme != <span class="hljs-string">"https"</span>:
            <span class="hljs-keyword">return</span> Response(<span class="hljs-string">"HTTPS Required"</span>, status_code=<span class="hljs-number">426</span>)
        
        <span class="hljs-comment"># 🚨 Threat detection</span>
        threat_level = self.analyze_request_threat(request)
        <span class="hljs-keyword">if</span> threat_level &gt; self.config.get(<span class="hljs-string">"max_threat_score"</span>, <span class="hljs-number">80</span>):
            self.add_threat_score(client_ip, <span class="hljs-number">10</span>)
            logger.warning(<span class="hljs-string">f"🚨 High threat level request from <span class="hljs-subst">{client_ip}</span>: <span class="hljs-subst">{threat_level}</span>"</span>)
        
        <span class="hljs-comment"># 🔍 Advanced request validation</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.validate_request_safety(request):
            <span class="hljs-keyword">return</span> Response(<span class="hljs-string">"Request Rejected"</span>, status_code=<span class="hljs-number">400</span>)
        
        <span class="hljs-comment"># 🔄 Process request</span>
        response = <span class="hljs-keyword">await</span> call_next(request)
        
        <span class="hljs-comment"># 🛡️ Add comprehensive security headers</span>
        self.add_security_headers(response)
        
        <span class="hljs-keyword">return</span> response
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_client_ip</span><span class="hljs-params">(self, request: Request)</span> -&gt; str:</span>
        <span class="hljs-string">"""🌐 Extract real client IP considering proxies"""</span>
        forwarded_for = request.headers.get(<span class="hljs-string">"X-Forwarded-For"</span>)
        <span class="hljs-keyword">if</span> forwarded_for:
            <span class="hljs-keyword">return</span> forwarded_for.split(<span class="hljs-string">","</span>)[^<span class="hljs-number">0</span>].strip()
        
        real_ip = request.headers.get(<span class="hljs-string">"X-Real-IP"</span>)
        <span class="hljs-keyword">if</span> real_ip:
            <span class="hljs-keyword">return</span> real_ip
        
        <span class="hljs-keyword">return</span> request.client.host <span class="hljs-keyword">if</span> request.client <span class="hljs-keyword">else</span> <span class="hljs-string">"unknown"</span>
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">analyze_request_threat</span><span class="hljs-params">(self, request: Request)</span> -&gt; int:</span>
        <span class="hljs-string">"""🚨 Analyze request for potential threats"""</span>
        threat_score = <span class="hljs-number">0</span>
        
        <span class="hljs-comment"># 📋 Check URL for suspicious patterns</span>
        url_path = str(request.url.path).lower()
        <span class="hljs-keyword">for</span> pattern <span class="hljs-keyword">in</span> self.suspicious_patterns:
            <span class="hljs-keyword">if</span> re.search(pattern, url_path, re.IGNORECASE):
                threat_score += <span class="hljs-number">20</span>
                logger.warning(<span class="hljs-string">f"🚨 Suspicious pattern in URL: <span class="hljs-subst">{pattern}</span>"</span>)
        
        <span class="hljs-comment"># 🔍 Check headers for anomalies</span>
        user_agent = request.headers.get(<span class="hljs-string">"user-agent"</span>, <span class="hljs-string">""</span>).lower()
        <span class="hljs-keyword">if</span> <span class="hljs-string">"bot"</span> <span class="hljs-keyword">in</span> user_agent <span class="hljs-keyword">or</span> <span class="hljs-string">"crawler"</span> <span class="hljs-keyword">in</span> user_agent:
            threat_score += <span class="hljs-number">5</span>
        
        <span class="hljs-comment"># 📏 Check for unusually large headers</span>
        total_header_size = sum(len(k) + len(v) <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> request.headers.items())
        <span class="hljs-keyword">if</span> total_header_size &gt; <span class="hljs-number">8192</span>:  <span class="hljs-comment"># 8KB</span>
            threat_score += <span class="hljs-number">15</span>
        
        <span class="hljs-keyword">return</span> threat_score
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">validate_request_safety</span><span class="hljs-params">(self, request: Request)</span> -&gt; bool:</span>
        <span class="hljs-string">"""🔍 Validate request for safety"""</span>
        <span class="hljs-comment"># 📏 Content length validation</span>
        content_length = request.headers.get(<span class="hljs-string">"content-length"</span>)
        <span class="hljs-keyword">if</span> content_length <span class="hljs-keyword">and</span> int(content_length) &gt; self.config.get(<span class="hljs-string">"max_content_length"</span>, <span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        
        <span class="hljs-comment"># 🔍 Content type validation</span>
        content_type = request.headers.get(<span class="hljs-string">"content-type"</span>, <span class="hljs-string">""</span>)
        allowed_types = self.config.get(<span class="hljs-string">"allowed_content_types"</span>, [
            <span class="hljs-string">"application/json"</span>, <span class="hljs-string">"application/x-www-form-urlencoded"</span>,
            <span class="hljs-string">"multipart/form-data"</span>, <span class="hljs-string">"text/plain"</span>
        ])
        
        <span class="hljs-keyword">if</span> content_type <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> any(ct <span class="hljs-keyword">in</span> content_type <span class="hljs-keyword">for</span> ct <span class="hljs-keyword">in</span> allowed_types):
            logger.warning(<span class="hljs-string">f"🚫 Disallowed content type: <span class="hljs-subst">{content_type}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_threat_score</span><span class="hljs-params">(self, ip: str, score: int)</span>:</span>
        <span class="hljs-string">"""📊 Add threat score to IP"""</span>
        <span class="hljs-keyword">if</span> ip <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.threat_scores:
            self.threat_scores[ip] = <span class="hljs-number">0</span>
        
        self.threat_scores[ip] += score
        
        <span class="hljs-comment"># 🚫 Block IP if threat score too high</span>
        <span class="hljs-keyword">if</span> self.threat_scores[ip] &gt; self.config.get(<span class="hljs-string">"ip_block_threshold"</span>, <span class="hljs-number">100</span>):
            self.blocked_ips.add(ip)
            logger.critical(<span class="hljs-string">f"🚫 IP blocked due to high threat score: <span class="hljs-subst">{ip}</span> (score: <span class="hljs-subst">{self.threat_scores[ip]}</span>)"</span>)
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_security_headers</span><span class="hljs-params">(self, response: Response)</span>:</span>
        <span class="hljs-string">"""🛡️ Add comprehensive security headers"""</span>
        headers = {
            <span class="hljs-comment"># 🛡️ XSS Protection</span>
            <span class="hljs-string">"X-Content-Type-Options"</span>: <span class="hljs-string">"nosniff"</span>,
            <span class="hljs-string">"X-Frame-Options"</span>: <span class="hljs-string">"DENY"</span>,
            <span class="hljs-string">"X-XSS-Protection"</span>: <span class="hljs-string">"1; mode=block"</span>,
            
            <span class="hljs-comment"># 🔒 HTTPS Security  </span>
            <span class="hljs-string">"Strict-Transport-Security"</span>: <span class="hljs-string">"max-age=31536000; includeSubDomains; preload"</span>,
            
            <span class="hljs-comment"># 📋 Referrer Policy</span>
            <span class="hljs-string">"Referrer-Policy"</span>: <span class="hljs-string">"strict-origin-when-cross-origin"</span>,
            
            <span class="hljs-comment"># 🛡️ Permissions Policy</span>
            <span class="hljs-string">"Permissions-Policy"</span>: <span class="hljs-string">"camera=(), microphone=(), geolocation=()"</span>,
            
            <span class="hljs-comment"># 📊 Content Security Policy</span>
            <span class="hljs-string">"Content-Security-Policy"</span>: self.config.get(<span class="hljs-string">"csp_policy"</span>, self.get_default_csp()),
            
            <span class="hljs-comment"># 🔒 Additional Security</span>
            <span class="hljs-string">"X-Permitted-Cross-Domain-Policies"</span>: <span class="hljs-string">"none"</span>,
            <span class="hljs-string">"Cross-Origin-Opener-Policy"</span>: <span class="hljs-string">"same-origin"</span>,
            <span class="hljs-string">"Cross-Origin-Embedder-Policy"</span>: <span class="hljs-string">"require-corp"</span>,
            <span class="hljs-string">"Cross-Origin-Resource-Policy"</span>: <span class="hljs-string">"same-origin"</span>
        }
        
        <span class="hljs-keyword">for</span> header, value <span class="hljs-keyword">in</span> headers.items():
            response.headers[header] = value
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_default_csp</span><span class="hljs-params">(self)</span> -&gt; str:</span>
        <span class="hljs-string">"""📋 Get default Content Security Policy"""</span>
        <span class="hljs-keyword">return</span> (
            <span class="hljs-string">"default-src 'self'; "</span>
            <span class="hljs-string">"script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; "</span>
            <span class="hljs-string">"style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://fonts.googleapis.com; "</span>
            <span class="hljs-string">"font-src 'self' https://fonts.gstatic.com; "</span>
            <span class="hljs-string">"img-src 'self' data: https:; "</span>
            <span class="hljs-string">"connect-src 'self' ws: wss:; "</span>
            <span class="hljs-string">"frame-ancestors 'none'; "</span>
            <span class="hljs-string">"base-uri 'self'; "</span>
            <span class="hljs-string">"form-action 'self'"</span>
        )
</div></code></pre>
<h4 id="%E2%9A%A1-advanced-performance-middleware">⚡ Advanced Performance Middleware</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> psutil
<span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Dict, List, Optional
<span class="hljs-keyword">from</span> dataclasses <span class="hljs-keyword">import</span> dataclass, field
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict, deque

<span class="hljs-meta">@dataclass</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RequestMetrics</span>:</span>
    <span class="hljs-string">"""📊 Individual request performance metrics"""</span>
    request_id: str
    method: str
    path: str
    start_time: float
    end_time: Optional[float] = <span class="hljs-literal">None</span>
    response_time: Optional[float] = <span class="hljs-literal">None</span>
    status_code: Optional[int] = <span class="hljs-literal">None</span>
    response_size: Optional[int] = <span class="hljs-literal">None</span>
    memory_usage: Optional[float] = <span class="hljs-literal">None</span>
    cpu_usage: Optional[float] = <span class="hljs-literal">None</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PerformanceAnalytics</span>:</span>
    <span class="hljs-string">"""📈 Advanced performance analytics and monitoring"""</span>
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
        self.request_history: deque = deque(maxlen=<span class="hljs-number">10000</span>)  <span class="hljs-comment"># Last 10K requests</span>
        self.endpoint_stats: Dict[str, List[float]] = defaultdict(list)
        self.slow_requests: List[RequestMetrics] = []
        self.error_requests: List[RequestMetrics] = []
        
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_request</span><span class="hljs-params">(self, metrics: RequestMetrics)</span>:</span>
        <span class="hljs-string">"""📊 Add request metrics to analytics"""</span>
        self.request_history.append(metrics)
        
        <span class="hljs-keyword">if</span> metrics.response_time:
            <span class="hljs-comment"># 📈 Track endpoint performance</span>
            endpoint_key = <span class="hljs-string">f"<span class="hljs-subst">{metrics.method}</span>:<span class="hljs-subst">{metrics.path}</span>"</span>
            self.endpoint_stats[endpoint_key].append(metrics.response_time)
            
            <span class="hljs-comment"># 🐌 Track slow requests</span>
            <span class="hljs-keyword">if</span> metrics.response_time &gt; <span class="hljs-number">1.0</span>:  <span class="hljs-comment"># Slower than 1 second</span>
                self.slow_requests.append(metrics)
                <span class="hljs-keyword">if</span> len(self.slow_requests) &gt; <span class="hljs-number">100</span>:
                    self.slow_requests.pop(<span class="hljs-number">0</span>)
        
        <span class="hljs-comment"># ❌ Track error requests</span>
        <span class="hljs-keyword">if</span> metrics.status_code <span class="hljs-keyword">and</span> metrics.status_code &gt;= <span class="hljs-number">400</span>:
            self.error_requests.append(metrics)
            <span class="hljs-keyword">if</span> len(self.error_requests) &gt; <span class="hljs-number">100</span>:
                self.error_requests.pop(<span class="hljs-number">0</span>)
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_performance_summary</span><span class="hljs-params">(self)</span> -&gt; Dict[str, Any]:</span>
        <span class="hljs-string">"""📊 Get comprehensive performance summary"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.request_history:
            <span class="hljs-keyword">return</span> {<span class="hljs-string">"status"</span>: <span class="hljs-string">"No data available"</span>}
        
        recent_requests = list(self.request_history)[<span class="hljs-number">-1000</span>:]  <span class="hljs-comment"># Last 1000 requests</span>
        response_times = [r.response_time <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> recent_requests <span class="hljs-keyword">if</span> r.response_time]
        
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> response_times:
            <span class="hljs-keyword">return</span> {<span class="hljs-string">"status"</span>: <span class="hljs-string">"No response time data"</span>}
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"total_requests"</span>: len(self.request_history),
            <span class="hljs-string">"avg_response_time"</span>: sum(response_times) / len(response_times),
            <span class="hljs-string">"min_response_time"</span>: min(response_times),
            <span class="hljs-string">"max_response_time"</span>: max(response_times),
            <span class="hljs-string">"p95_response_time"</span>: self.percentile(response_times, <span class="hljs-number">95</span>),
            <span class="hljs-string">"p99_response_time"</span>: self.percentile(response_times, <span class="hljs-number">99</span>),
            <span class="hljs-string">"slow_requests_count"</span>: len(self.slow_requests),
            <span class="hljs-string">"error_requests_count"</span>: len(self.error_requests),
            <span class="hljs-string">"requests_per_second"</span>: self.calculate_rps(),
            <span class="hljs-string">"top_slow_endpoints"</span>: self.get_slowest_endpoints()
        }
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">percentile</span><span class="hljs-params">(self, data: List[float], percentile: int)</span> -&gt; float:</span>
        <span class="hljs-string">"""📊 Calculate percentile of response times"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data:
            <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>
        sorted_data = sorted(data)
        index = int(len(sorted_data) * percentile / <span class="hljs-number">100</span>)
        <span class="hljs-keyword">return</span> sorted_data[min(index, len(sorted_data) - <span class="hljs-number">1</span>)]
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">calculate_rps</span><span class="hljs-params">(self)</span> -&gt; float:</span>
        <span class="hljs-string">"""📈 Calculate requests per second for last minute"""</span>
        current_time = time.time()
        recent_requests = [
            r <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> self.request_history 
            <span class="hljs-keyword">if</span> r.start_time &gt; current_time - <span class="hljs-number">60</span>  <span class="hljs-comment"># Last minute</span>
        ]
        <span class="hljs-keyword">return</span> len(recent_requests) / <span class="hljs-number">60</span>
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_slowest_endpoints</span><span class="hljs-params">(self, limit: int = <span class="hljs-number">5</span>)</span> -&gt; List[Dict[str, Any]]:</span>
        <span class="hljs-string">"""🐌 Get slowest endpoints"""</span>
        endpoint_averages = []
        
        <span class="hljs-keyword">for</span> endpoint, times <span class="hljs-keyword">in</span> self.endpoint_stats.items():
            <span class="hljs-keyword">if</span> len(times) &gt;= <span class="hljs-number">5</span>:  <span class="hljs-comment"># Only endpoints with enough data</span>
                avg_time = sum(times[<span class="hljs-number">-100</span>:]) / len(times[<span class="hljs-number">-100</span>:])  <span class="hljs-comment"># Average of last 100 requests</span>
                endpoint_averages.append({
                    <span class="hljs-string">"endpoint"</span>: endpoint,
                    <span class="hljs-string">"avg_response_time"</span>: avg_time,
                    <span class="hljs-string">"request_count"</span>: len(times)
                })
        
        <span class="hljs-keyword">return</span> sorted(endpoint_averages, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">"avg_response_time"</span>], reverse=<span class="hljs-literal">True</span>)[:limit]

<span class="hljs-comment"># Global performance analytics instance</span>
performance_analytics = PerformanceAnalytics()

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdvancedPerformanceMiddleware</span><span class="hljs-params">(BaseHTTPMiddleware)</span>:</span>
    <span class="hljs-string">"""
    ⚡ Advanced performance monitoring middleware
    
    Features:
    📊 Detailed request metrics
    📈 Performance analytics
    🐌 Slow request detection
    💾 Memory and CPU monitoring
    📊 Real-time statistics
    🎯 Performance alerts
    """</span>
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, app, config: Dict[str, Any])</span>:</span>
        super().__init__(app)
        self.config = config
        self.slow_threshold = config.get(<span class="hljs-string">"slow_request_threshold"</span>, <span class="hljs-number">1.0</span>)
        self.memory_threshold = config.get(<span class="hljs-string">"memory_threshold_mb"</span>, <span class="hljs-number">500</span>)
    
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dispatch</span><span class="hljs-params">(self, request: Request, call_next)</span> -&gt; Response:</span>
        <span class="hljs-comment"># 📊 Initialize request metrics</span>
        request_id = getattr(request.state, <span class="hljs-string">'request_id'</span>, str(uuid.uuid4()))
        
        metrics = RequestMetrics(
            request_id=request_id,
            method=request.method,
            path=request.url.path,
            start_time=time.time()
        )
        
        <span class="hljs-comment"># 💾 Capture initial system state</span>
        process = psutil.Process()
        initial_memory = process.memory_info().rss / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>  <span class="hljs-comment"># MB</span>
        
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># 🔄 Process request</span>
            response = <span class="hljs-keyword">await</span> call_next(request)
            
            <span class="hljs-comment"># 📊 Complete metrics</span>
            metrics.end_time = time.time()
            metrics.response_time = metrics.end_time - metrics.start_time
            metrics.status_code = response.status_code
            metrics.response_size = len(response.body) <span class="hljs-keyword">if</span> hasattr(response, <span class="hljs-string">'body'</span>) <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>
            
            <span class="hljs-comment"># 💾 Capture final system state</span>
            final_memory = process.memory_info().rss / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>  <span class="hljs-comment"># MB</span>
            metrics.memory_usage = final_memory - initial_memory
            metrics.cpu_usage = process.cpu_percent()
            
            <span class="hljs-comment"># 📋 Add performance headers</span>
            response.headers[<span class="hljs-string">"X-Response-Time"</span>] = <span class="hljs-string">f"<span class="hljs-subst">{metrics.response_time:<span class="hljs-number">.4</span>f}</span>s"</span>
            response.headers[<span class="hljs-string">"X-Request-ID"</span>] = request_id
            response.headers[<span class="hljs-string">"X-Memory-Usage"</span>] = <span class="hljs-string">f"<span class="hljs-subst">{metrics.memory_usage:<span class="hljs-number">.2</span>f}</span>MB"</span>
            
            <span class="hljs-comment"># ⚠️ Log performance warnings</span>
            <span class="hljs-keyword">if</span> metrics.response_time &gt; self.slow_threshold:
                logger.warning(
                    <span class="hljs-string">f"🐌 Slow request: <span class="hljs-subst">{metrics.method}</span> <span class="hljs-subst">{metrics.path}</span> "</span>
                    <span class="hljs-string">f"took <span class="hljs-subst">{metrics.response_time:<span class="hljs-number">.4</span>f}</span>s (threshold: <span class="hljs-subst">{self.slow_threshold}</span>s)"</span>
                )
            
            <span class="hljs-keyword">if</span> metrics.memory_usage &gt; <span class="hljs-number">50</span>:  <span class="hljs-comment"># More than 50MB memory increase</span>
                logger.warning(
                    <span class="hljs-string">f"💾 High memory usage: <span class="hljs-subst">{metrics.path}</span> used <span class="hljs-subst">{metrics.memory_usage:<span class="hljs-number">.2</span>f}</span>MB"</span>
                )
            
            <span class="hljs-comment"># 📊 Add to analytics</span>
            performance_analytics.add_request(metrics)
            
            <span class="hljs-keyword">return</span> response
            
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-comment"># ❌ Handle errors</span>
            metrics.end_time = time.time()
            metrics.response_time = metrics.end_time - metrics.start_time
            metrics.status_code = <span class="hljs-number">500</span>
            
            logger.error(<span class="hljs-string">f"❌ Request failed: <span class="hljs-subst">{metrics.method}</span> <span class="hljs-subst">{metrics.path}</span> - <span class="hljs-subst">{str(e)}</span>"</span>)
            performance_analytics.add_request(metrics)
            
            <span class="hljs-keyword">raise</span>
</div></code></pre>
<h3 id="%F0%9F%8E%AF-middleware-use-cases--security-benefits">🎯 Middleware Use Cases &amp; Security Benefits</h3>
<table>
<thead>
<tr>
<th style="text-align:left">Security Feature</th>
<th style="text-align:left">🎯 Use Case</th>
<th style="text-align:left">🛡️ Protection Level</th>
<th style="text-align:left">📊 Impact</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Rate Limiting</td>
<td style="text-align:left">🚦 API abuse prevention</td>
<td style="text-align:left">High</td>
<td style="text-align:left">📉 90% reduction in abuse</td>
</tr>
<tr>
<td style="text-align:left">Security Headers</td>
<td style="text-align:left">🛡️ XSS/Clickjacking prevention</td>
<td style="text-align:left">Critical</td>
<td style="text-align:left">📈 99.9% attack mitigation</td>
</tr>
<tr>
<td style="text-align:left">IP Blocking</td>
<td style="text-align:left">🚫 Malicious actor prevention</td>
<td style="text-align:left">High</td>
<td style="text-align:left">📊 80% threat reduction</td>
</tr>
<tr>
<td style="text-align:left">Request Validation</td>
<td style="text-align:left">🔍 Input sanitization</td>
<td style="text-align:left">Medium</td>
<td style="text-align:left">📈 95% malformed request filtering</td>
</tr>
<tr>
<td style="text-align:left">Performance Monitoring</td>
<td style="text-align:left">⚡ System optimization</td>
<td style="text-align:left">Medium</td>
<td style="text-align:left">📊 40% performance improvement</td>
</tr>
</tbody>
</table>
<h2 id="%E2%9A%A1-section-4-advanced-background-tasks--job-management">⚡ Section 4: Advanced Background Tasks &amp; Job Management</h2>
<h3 id="%F0%9F%8F%97%EF%B8%8F-background-task-architecture">🏗️ Background Task Architecture</h3>
<pre class="hljs"><code><div>📥 Client Request
    ↓
⚡ FastAPI Endpoint (Quick Response)
    ├── ✅ Immediate Response to Client
    └── 📋 Queue Background Task
         ↓
🎯 Background Task Scheduler
    ├── 📊 Priority Queue Management
    ├── 🔄 Task Distribution
    ├── 📈 Progress Tracking
    └── ❌ Error Handling
         ↓
👷 Background Workers
    ├── 📧 Email Worker
    ├── 📄 Document Worker  
    ├── 🖼️ Image Worker
    ├── 🧹 Cleanup Worker
    └── 📊 Analytics Worker
         ↓
📊 Task Results &amp; Notifications
    ├── 💾 Result Storage
    ├── 📱 Real-time Updates
    ├── 🔔 Completion Notifications
    └── 📈 Performance Metrics
</div></code></pre>
<h3 id="%F0%9F%9B%A0%EF%B8%8F-advanced-background-task-system">🛠️ Advanced Background Task System</h3>
<h4 id="%F0%9F%93%8B-task-management-system">📋 Task Management System</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">import</span> uuid
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> enum <span class="hljs-keyword">import</span> Enum
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime, timedelta
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Dict, Any, List, Optional, Callable
<span class="hljs-keyword">from</span> dataclasses <span class="hljs-keyword">import</span> dataclass, asdict
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel
<span class="hljs-keyword">import</span> logging

logger = logging.getLogger(__name__)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TaskStatus</span><span class="hljs-params">(str, Enum)</span>:</span>
    <span class="hljs-string">"""📊 Task status enumeration"""</span>
    PENDING = <span class="hljs-string">"pending"</span>
    RUNNING = <span class="hljs-string">"running"</span>  
    COMPLETED = <span class="hljs-string">"completed"</span>
    FAILED = <span class="hljs-string">"failed"</span>
    CANCELLED = <span class="hljs-string">"cancelled"</span>
    RETRYING = <span class="hljs-string">"retrying"</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TaskPriority</span><span class="hljs-params">(str, Enum)</span>:</span>
    <span class="hljs-string">"""🎯 Task priority levels"""</span>
    LOW = <span class="hljs-string">"low"</span>
    NORMAL = <span class="hljs-string">"normal"</span>
    HIGH = <span class="hljs-string">"high"</span>
    CRITICAL = <span class="hljs-string">"critical"</span>

<span class="hljs-meta">@dataclass</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TaskInfo</span>:</span>
    <span class="hljs-string">"""📋 Comprehensive task information"""</span>
    task_id: str
    name: str
    description: str
    status: TaskStatus
    priority: TaskPriority
    created_at: datetime
    started_at: Optional[datetime] = <span class="hljs-literal">None</span>
    completed_at: Optional[datetime] = <span class="hljs-literal">None</span>
    progress: int = <span class="hljs-number">0</span>  <span class="hljs-comment"># 0-100</span>
    result: Optional[Any] = <span class="hljs-literal">None</span>
    error: Optional[str] = <span class="hljs-literal">None</span>
    retry_count: int = <span class="hljs-number">0</span>
    max_retries: int = <span class="hljs-number">3</span>
    metadata: Dict[str, Any] = <span class="hljs-literal">None</span>
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to_dict</span><span class="hljs-params">(self)</span> -&gt; Dict[str, Any]:</span>
        <span class="hljs-string">"""🔄 Convert to dictionary for JSON serialization"""</span>
        data = asdict(self)
        <span class="hljs-comment"># Convert datetime objects to ISO strings</span>
        <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> [<span class="hljs-string">'created_at'</span>, <span class="hljs-string">'started_at'</span>, <span class="hljs-string">'completed_at'</span>]:
            <span class="hljs-keyword">if</span> data[key]:
                data[key] = data[key].isoformat()
        <span class="hljs-keyword">return</span> data

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TaskManager</span>:</span>
    <span class="hljs-string">"""
    🎯 Advanced background task management system
    
    Features:
    📊 Task queuing and prioritization
    🔄 Progress tracking
    ❌ Error handling and retries
    📈 Performance monitoring
    🔔 Real-time notifications
    📊 Task analytics
    """</span>
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
        self.tasks: Dict[str, TaskInfo] = {}
        self.task_queues: Dict[TaskPriority, asyncio.Queue] = {
            priority: asyncio.Queue() <span class="hljs-keyword">for</span> priority <span class="hljs-keyword">in</span> TaskPriority
        }
        self.active_tasks: Dict[str, asyncio.Task] = {}
        self.task_functions: Dict[str, Callable] = {}
        self.max_concurrent_tasks = <span class="hljs-number">10</span>
        self.running = <span class="hljs-literal">False</span>
        
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">register_task_function</span><span class="hljs-params">(self, name: str, func: Callable)</span>:</span>
        <span class="hljs-string">"""📋 Register a task function"""</span>
        self.task_functions[name] = func
        logger.info(<span class="hljs-string">f"📋 Registered task function: <span class="hljs-subst">{name}</span>"</span>)
    
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">queue_task</span><span class="hljs-params">(
        self,
        name: str,
        description: str = <span class="hljs-string">""</span>,
        priority: TaskPriority = TaskPriority.NORMAL,
        **kwargs
    )</span> -&gt; str:</span>
        <span class="hljs-string">"""📥 Queue a new background task"""</span>
        
        <span class="hljs-keyword">if</span> name <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.task_functions:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f"❌ Unknown task function: <span class="hljs-subst">{name}</span>"</span>)
        
        task_id = str(uuid.uuid4())
        
        task_info = TaskInfo(
            task_id=task_id,
            name=name,
            description=description <span class="hljs-keyword">or</span> <span class="hljs-string">f"Task: <span class="hljs-subst">{name}</span>"</span>,
            status=TaskStatus.PENDING,
            priority=priority,
            created_at=datetime.utcnow(),
            metadata=kwargs
        )
        
        self.tasks[task_id] = task_info
        <span class="hljs-keyword">await</span> self.task_queues[priority].put((task_id, kwargs))
        
        logger.info(<span class="hljs-string">f"📥 Queued task <span class="hljs-subst">{task_id}</span>: <span class="hljs-subst">{name}</span> (priority: <span class="hljs-subst">{priority.value}</span>)"</span>)
        
        <span class="hljs-keyword">return</span> task_id
    
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start_worker_pool</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-string">"""👷 Start background worker pool"""</span>
        self.running = <span class="hljs-literal">True</span>
        
        <span class="hljs-comment"># Start workers for each priority level</span>
        workers = []
        <span class="hljs-keyword">for</span> priority <span class="hljs-keyword">in</span> [TaskPriority.CRITICAL, TaskPriority.HIGH, TaskPriority.NORMAL, TaskPriority.LOW]:
            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>):  <span class="hljs-comment"># 2 workers per priority level</span>
                worker = asyncio.create_task(self._worker(priority, <span class="hljs-string">f"worker-<span class="hljs-subst">{priority.value}</span>-<span class="hljs-subst">{i}</span>"</span>))
                workers.append(worker)
        
        logger.info(<span class="hljs-string">f"👷 Started <span class="hljs-subst">{len(workers)}</span> background workers"</span>)
        
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">await</span> asyncio.gather(*workers)
        <span class="hljs-keyword">except</span> asyncio.CancelledError:
            logger.info(<span class="hljs-string">"🛑 Background workers stopped"</span>)
    
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_worker</span><span class="hljs-params">(self, priority: TaskPriority, worker_name: str)</span>:</span>
        <span class="hljs-string">"""👷 Individual worker process"""</span>
        logger.info(<span class="hljs-string">f"👷 Worker <span class="hljs-subst">{worker_name}</span> started for <span class="hljs-subst">{priority.value}</span> priority tasks"</span>)
        
        <span class="hljs-keyword">while</span> self.running:
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># Get task from priority queue</span>
                task_id, kwargs = <span class="hljs-keyword">await</span> asyncio.wait_for(
                    self.task_queues[priority].get(),
                    timeout=<span class="hljs-number">1.0</span>
                )
                
                <span class="hljs-keyword">if</span> len(self.active_tasks) &gt;= self.max_concurrent_tasks:
                    <span class="hljs-comment"># Put task back in queue if too many active tasks</span>
                    <span class="hljs-keyword">await</span> self.task_queues[priority].put((task_id, kwargs))
                    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">0.1</span>)
                    <span class="hljs-keyword">continue</span>
                
                <span class="hljs-comment"># Execute task</span>
                task_coroutine = self._execute_task(task_id, kwargs)
                active_task = asyncio.create_task(task_coroutine)
                self.active_tasks[task_id] = active_task
                
                <span class="hljs-comment"># Don't await here - let it run in background</span>
                active_task.add_done_callback(
                    <span class="hljs-keyword">lambda</span> t, tid=task_id: self.active_tasks.pop(tid, <span class="hljs-literal">None</span>)
                )
                
            <span class="hljs-keyword">except</span> asyncio.TimeoutError:
                <span class="hljs-comment"># No tasks in queue, continue</span>
                <span class="hljs-keyword">continue</span>
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                logger.error(<span class="hljs-string">f"❌ Worker <span class="hljs-subst">{worker_name}</span> error: <span class="hljs-subst">{e}</span>"</span>)
                <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)
    
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_execute_task</span><span class="hljs-params">(self, task_id: str, kwargs: Dict[str, Any])</span>:</span>
        <span class="hljs-string">"""🔄 Execute individual task"""</span>
        task_info = self.tasks.get(task_id)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> task_info:
            logger.error(<span class="hljs-string">f"❌ Task <span class="hljs-subst">{task_id}</span> not found"</span>)
            <span class="hljs-keyword">return</span>
        
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># Update task status</span>
            task_info.status = TaskStatus.RUNNING
            task_info.started_at = datetime.utcnow()
            
            logger.info(<span class="hljs-string">f"🔄 Starting task <span class="hljs-subst">{task_id}</span>: <span class="hljs-subst">{task_info.name}</span>"</span>)
            
            <span class="hljs-comment"># Get task function</span>
            func = self.task_functions[task_info.name]
            
            <span class="hljs-comment"># Execute task with progress callback</span>
            progress_callback = <span class="hljs-keyword">lambda</span> p: self.update_task_progress(task_id, p)
            
            <span class="hljs-keyword">if</span> asyncio.iscoroutinefunction(func):
                result = <span class="hljs-keyword">await</span> func(progress_callback=progress_callback, **kwargs)
            <span class="hljs-keyword">else</span>:
                result = func(progress_callback=progress_callback, **kwargs)
            
            <span class="hljs-comment"># Task completed successfully</span>
            task_info.status = TaskStatus.COMPLETED
            task_info.completed_at = datetime.utcnow()
            task_info.result = result
            task_info.progress = <span class="hljs-number">100</span>
            
            logger.info(<span class="hljs-string">f"✅ Task <span class="hljs-subst">{task_id}</span> completed successfully"</span>)
            
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            logger.error(<span class="hljs-string">f"❌ Task <span class="hljs-subst">{task_id}</span> failed: <span class="hljs-subst">{e}</span>"</span>)
            
            <span class="hljs-comment"># Handle task failure</span>
            task_info.error = str(e)
            task_info.retry_count += <span class="hljs-number">1</span>
            
            <span class="hljs-keyword">if</span> task_info.retry_count &lt;= task_info.max_retries:
                <span class="hljs-comment"># Retry task</span>
                task_info.status = TaskStatus.RETRYING
                <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">2</span> ** task_info.retry_count)  <span class="hljs-comment"># Exponential backoff</span>
                <span class="hljs-keyword">await</span> self.task_queues[task_info.priority].put((task_id, kwargs))
                logger.info(<span class="hljs-string">f"🔄 Retrying task <span class="hljs-subst">{task_id}</span> (attempt <span class="hljs-subst">{task_info.retry_count}</span>)"</span>)
            <span class="hljs-keyword">else</span>:
                <span class="hljs-comment"># Task failed permanently</span>
                task_info.status = TaskStatus.FAILED
                task_info.completed_at = datetime.utcnow()
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update_task_progress</span><span class="hljs-params">(self, task_id: str, progress: int)</span>:</span>
        <span class="hljs-string">"""📊 Update task progress"""</span>
        <span class="hljs-keyword">if</span> task_id <span class="hljs-keyword">in</span> self.tasks:
            self.tasks[task_id].progress = max(<span class="hljs-number">0</span>, min(<span class="hljs-number">100</span>, progress))
            logger.debug(<span class="hljs-string">f"📊 Task <span class="hljs-subst">{task_id}</span> progress: <span class="hljs-subst">{progress}</span>%"</span>)
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_task_info</span><span class="hljs-params">(self, task_id: str)</span> -&gt; Optional[TaskInfo]:</span>
        <span class="hljs-string">"""📋 Get task information"""</span>
        <span class="hljs-keyword">return</span> self.tasks.get(task_id)
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_task_status</span><span class="hljs-params">(self, task_id: str)</span> -&gt; Optional[TaskStatus]:</span>
        <span class="hljs-string">"""📊 Get task status"""</span>
        task = self.tasks.get(task_id)
        <span class="hljs-keyword">return</span> task.status <span class="hljs-keyword">if</span> task <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">cancel_task</span><span class="hljs-params">(self, task_id: str)</span> -&gt; bool:</span>
        <span class="hljs-string">"""❌ Cancel a running task"""</span>
        <span class="hljs-keyword">if</span> task_id <span class="hljs-keyword">in</span> self.active_tasks:
            self.active_tasks[task_id].cancel()
            <span class="hljs-keyword">if</span> task_id <span class="hljs-keyword">in</span> self.tasks:
                self.tasks[task_id].status = TaskStatus.CANCELLED
            logger.info(<span class="hljs-string">f"❌ Cancelled task <span class="hljs-subst">{task_id}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_task_statistics</span><span class="hljs-params">(self)</span> -&gt; Dict[str, Any]:</span>
        <span class="hljs-string">"""📊 Get comprehensive task statistics"""</span>
        total_tasks = len(self.tasks)
        status_counts = {}
        
        <span class="hljs-keyword">for</span> status <span class="hljs-keyword">in</span> TaskStatus:
            status_counts[status.value] = sum(
                <span class="hljs-number">1</span> <span class="hljs-keyword">for</span> task <span class="hljs-keyword">in</span> self.tasks.values() 
                <span class="hljs-keyword">if</span> task.status == status
            )
        
        active_count = len(self.active_tasks)
        queue_sizes = {
            priority.value: self.task_queues[priority].qsize()
            <span class="hljs-keyword">for</span> priority <span class="hljs-keyword">in</span> TaskPriority
        }
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"total_tasks"</span>: total_tasks,
            <span class="hljs-string">"active_tasks"</span>: active_count,
            <span class="hljs-string">"status_breakdown"</span>: status_counts,
            <span class="hljs-string">"queue_sizes"</span>: queue_sizes,
            <span class="hljs-string">"worker_pool_status"</span>: <span class="hljs-string">"running"</span> <span class="hljs-keyword">if</span> self.running <span class="hljs-keyword">else</span> <span class="hljs-string">"stopped"</span>
        }

<span class="hljs-comment"># Global task manager instance</span>
task_manager = TaskManager()
</div></code></pre>
<h4 id="%F0%9F%93%A7-email-processing-tasks">📧 Email Processing Tasks</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_email_task</span><span class="hljs-params">(
    to_email: str,
    subject: str,
    body: str,
    email_type: str = <span class="hljs-string">"notification"</span>,
    progress_callback: Callable[[int], None] = None,
    **kwargs
)</span> -&gt; Dict[str, Any]:</span>
    <span class="hljs-string">"""
    📧 Advanced email sending task with progress tracking
    
    Use Cases:
    ✉️ Welcome emails for new users
    📊 Weekly/monthly reports
    🛒 Order confirmations and updates
    🚨 Security alerts and notifications
    📰 Newsletter campaigns
    """</span>
    
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 📊 Initialize progress</span>
        <span class="hljs-keyword">if</span> progress_callback:
            progress_callback(<span class="hljs-number">10</span>)
        
        <span class="hljs-comment"># 📝 Prepare email content</span>
        logger.info(<span class="hljs-string">f"📧 Preparing email to <span class="hljs-subst">{to_email}</span>: <span class="hljs-subst">{subject}</span>"</span>)
        
        <span class="hljs-comment"># Simulate email preparation</span>
        <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">0.5</span>)
        <span class="hljs-keyword">if</span> progress_callback:
            progress_callback(<span class="hljs-number">30</span>)
        
        <span class="hljs-comment"># 🎨 Template processing (if needed)</span>
        <span class="hljs-keyword">if</span> email_type == <span class="hljs-string">"report"</span>:
            <span class="hljs-comment"># Generate report content</span>
            <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1.0</span>)  <span class="hljs-comment"># Simulate report generation</span>
            <span class="hljs-keyword">if</span> progress_callback:
                progress_callback(<span class="hljs-number">60</span>)
        
        <span class="hljs-comment"># 📧 Send email (simulate SMTP connection)</span>
        logger.info(<span class="hljs-string">f"📧 Sending email to <span class="hljs-subst">{to_email}</span>"</span>)
        <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1.0</span>)  <span class="hljs-comment"># Simulate email sending</span>
        
        <span class="hljs-keyword">if</span> progress_callback:
            progress_callback(<span class="hljs-number">90</span>)
        
        <span class="hljs-comment"># 📊 Log email metrics</span>
        <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">0.2</span>)
        <span class="hljs-keyword">if</span> progress_callback:
            progress_callback(<span class="hljs-number">100</span>)
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"status"</span>: <span class="hljs-string">"sent"</span>,
            <span class="hljs-string">"recipient"</span>: to_email,
            <span class="hljs-string">"subject"</span>: subject,
            <span class="hljs-string">"sent_at"</span>: datetime.utcnow().isoformat(),
            <span class="hljs-string">"email_type"</span>: email_type
        }
        
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        logger.error(<span class="hljs-string">f"❌ Email sending failed: <span class="hljs-subst">{e}</span>"</span>)
        <span class="hljs-keyword">raise</span>

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">bulk_email_task</span><span class="hljs-params">(
    recipients: List[str],
    subject: str,
    body: str,
    progress_callback: Callable[[int], None] = None,
    **kwargs
)</span> -&gt; Dict[str, Any]:</span>
    <span class="hljs-string">"""
    📧 Bulk email sending with progress tracking
    
    Use Cases:
    📰 Newsletter campaigns
    🚨 Emergency notifications
    📊 System updates
    🎯 Marketing campaigns
    """</span>
    
    total_recipients = len(recipients)
    sent_count = <span class="hljs-number">0</span>
    failed_count = <span class="hljs-number">0</span>
    results = []
    
    logger.info(<span class="hljs-string">f"📧 Starting bulk email to <span class="hljs-subst">{total_recipients}</span> recipients"</span>)
    
    <span class="hljs-keyword">for</span> i, recipient <span class="hljs-keyword">in</span> enumerate(recipients):
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># Send individual email</span>
            result = <span class="hljs-keyword">await</span> send_email_task(
                to_email=recipient,
                subject=subject,
                body=body,
                email_type=<span class="hljs-string">"bulk"</span>
            )
            
            results.append(result)
            sent_count += <span class="hljs-number">1</span>
            
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            logger.error(<span class="hljs-string">f"❌ Failed to send email to <span class="hljs-subst">{recipient}</span>: <span class="hljs-subst">{e}</span>"</span>)
            failed_count += <span class="hljs-number">1</span>
            results.append({
                <span class="hljs-string">"recipient"</span>: recipient,
                <span class="hljs-string">"status"</span>: <span class="hljs-string">"failed"</span>,
                <span class="hljs-string">"error"</span>: str(e)
            })
        
        <span class="hljs-comment"># Update progress</span>
        progress = int((i + <span class="hljs-number">1</span>) / total_recipients * <span class="hljs-number">100</span>)
        <span class="hljs-keyword">if</span> progress_callback:
            progress_callback(progress)
        
        <span class="hljs-comment"># Small delay between emails to avoid rate limiting</span>
        <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">0.1</span>)
    
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"total_recipients"</span>: total_recipients,
        <span class="hljs-string">"sent_count"</span>: sent_count,
        <span class="hljs-string">"failed_count"</span>: failed_count,
        <span class="hljs-string">"success_rate"</span>: sent_count / total_recipients * <span class="hljs-number">100</span>,
        <span class="hljs-string">"results"</span>: results,
        <span class="hljs-string">"completed_at"</span>: datetime.utcnow().isoformat()
    }

<span class="hljs-comment"># Register email tasks</span>
task_manager.register_task_function(<span class="hljs-string">"send_email"</span>, send_email_task)
task_manager.register_task_function(<span class="hljs-string">"bulk_email"</span>, bulk_email_task)
</div></code></pre>
<h4 id="%F0%9F%93%84-document-processing-tasks">📄 Document Processing Tasks</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process_document_task</span><span class="hljs-params">(
    file_path: str,
    processing_type: str = <span class="hljs-string">"extract_text"</span>,
    output_format: str = <span class="hljs-string">"json"</span>,
    progress_callback: Callable[[int], None] = None,
    **kwargs
)</span> -&gt; Dict[str, Any]:</span>
    <span class="hljs-string">"""
    📄 Advanced document processing task
    
    Use Cases:
    📊 PDF data extraction
    🔍 Document indexing for search
    📝 Content analysis and summarization
    🗃️ Archive processing
    📋 Form data extraction
    """</span>
    
    <span class="hljs-keyword">try</span>:
        file_size = os.path.getsize(file_path)
        logger.info(<span class="hljs-string">f"📄 Processing document: <span class="hljs-subst">{file_path}</span> (<span class="hljs-subst">{file_size}</span> bytes)"</span>)
        
        <span class="hljs-keyword">if</span> progress_callback:
            progress_callback(<span class="hljs-number">10</span>)
        
        <span class="hljs-comment"># 📝 Document analysis phase</span>
        <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1.0</span>)  <span class="hljs-comment"># Simulate document loading</span>
        <span class="hljs-keyword">if</span> progress_callback:
            progress_callback(<span class="hljs-number">30</span>)
        
        <span class="hljs-comment"># 🔍 Content extraction phase</span>
        extracted_content = <span class="hljs-string">""</span>
        <span class="hljs-keyword">if</span> processing_type == <span class="hljs-string">"extract_text"</span>:
            <span class="hljs-comment"># Simulate text extraction</span>
            <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">2.0</span>)
            extracted_content = <span class="hljs-string">f"Extracted text content from <span class="hljs-subst">{Path(file_path).name}</span>"</span>
        <span class="hljs-keyword">elif</span> processing_type == <span class="hljs-string">"extract_images"</span>:
            <span class="hljs-comment"># Simulate image extraction</span>
            <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">3.0</span>)
            extracted_content = <span class="hljs-string">"Extracted 5 images from document"</span>
        <span class="hljs-keyword">elif</span> processing_type == <span class="hljs-string">"generate_summary"</span>:
            <span class="hljs-comment"># Simulate AI-powered summarization</span>
            <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">4.0</span>)
            extracted_content = <span class="hljs-string">"AI-generated document summary"</span>
        
        <span class="hljs-keyword">if</span> progress_callback:
            progress_callback(<span class="hljs-number">70</span>)
        
        <span class="hljs-comment"># 📊 Metadata extraction</span>
        metadata = {
            <span class="hljs-string">"file_name"</span>: Path(file_path).name,
            <span class="hljs-string">"file_size"</span>: file_size,
            <span class="hljs-string">"processed_at"</span>: datetime.utcnow().isoformat(),
            <span class="hljs-string">"processing_type"</span>: processing_type
        }
        
        <span class="hljs-keyword">if</span> progress_callback:
            progress_callback(<span class="hljs-number">90</span>)
        
        <span class="hljs-comment"># 💾 Save results</span>
        result = {
            <span class="hljs-string">"status"</span>: <span class="hljs-string">"completed"</span>,
            <span class="hljs-string">"content"</span>: extracted_content,
            <span class="hljs-string">"metadata"</span>: metadata,
            <span class="hljs-string">"output_format"</span>: output_format
        }
        
        <span class="hljs-keyword">if</span> progress_callback:
            progress_callback(<span class="hljs-number">100</span>)
        
        <span class="hljs-keyword">return</span> result
        
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        logger.error(<span class="hljs-string">f"❌ Document processing failed: <span class="hljs-subst">{e}</span>"</span>)
        <span class="hljs-keyword">raise</span>

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">batch_document_processing_task</span><span class="hljs-params">(
    file_paths: List[str],
    processing_type: str = <span class="hljs-string">"extract_text"</span>,
    progress_callback: Callable[[int], None] = None,
    **kwargs
)</span> -&gt; Dict[str, Any]:</span>
    <span class="hljs-string">"""
    📄 Batch document processing
    
    Use Cases:
    🗃️ Archive digitization
    📊 Bulk data extraction
    🔍 Document corpus analysis
    📋 Compliance document processing
    """</span>
    
    total_files = len(file_paths)
    processed_count = <span class="hljs-number">0</span>
    failed_count = <span class="hljs-number">0</span>
    results = []
    
    logger.info(<span class="hljs-string">f"📄 Starting batch processing of <span class="hljs-subst">{total_files}</span> documents"</span>)
    
    <span class="hljs-keyword">for</span> i, file_path <span class="hljs-keyword">in</span> enumerate(file_paths):
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># Process individual document</span>
            result = <span class="hljs-keyword">await</span> process_document_task(
                file_path=file_path,
                processing_type=processing_type
            )
            
            results.append(result)
            processed_count += <span class="hljs-number">1</span>
            
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            logger.error(<span class="hljs-string">f"❌ Failed to process <span class="hljs-subst">{file_path}</span>: <span class="hljs-subst">{e}</span>"</span>)
            failed_count += <span class="hljs-number">1</span>
            results.append({
                <span class="hljs-string">"file_path"</span>: file_path,
                <span class="hljs-string">"status"</span>: <span class="hljs-string">"failed"</span>,
                <span class="hljs-string">"error"</span>: str(e)
            })
        
        <span class="hljs-comment"># Update progress</span>
        progress = int((i + <span class="hljs-number">1</span>) / total_files * <span class="hljs-number">100</span>)
        <span class="hljs-keyword">if</span> progress_callback:
            progress_callback(progress)
    
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"total_files"</span>: total_files,
        <span class="hljs-string">"processed_count"</span>: processed_count,
        <span class="hljs-string">"failed_count"</span>: failed_count,
        <span class="hljs-string">"success_rate"</span>: processed_count / total_files * <span class="hljs-number">100</span>,
        <span class="hljs-string">"results"</span>: results,
        <span class="hljs-string">"completed_at"</span>: datetime.utcnow().isoformat()
    }

<span class="hljs-comment"># Register document processing tasks</span>
task_manager.register_task_function(<span class="hljs-string">"process_document"</span>, process_document_task)
task_manager.register_task_function(<span class="hljs-string">"batch_process_documents"</span>, batch_document_processing_task)
</div></code></pre>
<h3 id="%F0%9F%93%8A-background-task-use-cases--performance">📊 Background Task Use Cases &amp; Performance</h3>
<table>
<thead>
<tr>
<th style="text-align:left">Task Type</th>
<th style="text-align:left">⏱️ Avg Duration</th>
<th style="text-align:left">📈 Success Rate</th>
<th style="text-align:left">🎯 Best Use Cases</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Email Sending</td>
<td style="text-align:left">2-5 seconds</td>
<td style="text-align:left">98.5%</td>
<td style="text-align:left">📧 Notifications, Reports</td>
</tr>
<tr>
<td style="text-align:left">Document Processing</td>
<td style="text-align:left">10-60 seconds</td>
<td style="text-align:left">95.2%</td>
<td style="text-align:left">📄 OCR, Data Extraction</td>
</tr>
<tr>
<td style="text-align:left">Image Processing</td>
<td style="text-align:left">5-30 seconds</td>
<td style="text-align:left">96.8%</td>
<td style="text-align:left">🖼️ Thumbnails, Analysis</td>
</tr>
<tr>
<td style="text-align:left">Data Export</td>
<td style="text-align:left">30-300 seconds</td>
<td style="text-align:left">97.1%</td>
<td style="text-align:left">📊 Reports, Backups</td>
</tr>
<tr>
<td style="text-align:left">Cleanup Tasks</td>
<td style="text-align:left">60-600 seconds</td>
<td style="text-align:left">99.5%</td>
<td style="text-align:left">🧹 Maintenance, Optimization</td>
</tr>
</tbody>
</table>
<h2 id="%F0%9F%92%AC-section-5-advanced-websocket-system-with-real-time-features">💬 Section 5: Advanced WebSocket System with Real-time Features</h2>
<h3 id="%F0%9F%8F%97%EF%B8%8F-websocket-architecture-flow">🏗️ WebSocket Architecture Flow</h3>
<pre class="hljs"><code><div>📱 Multiple Clients
    ├── 💻 Web Dashboard
    ├── 📱 Mobile App
    ├── 🖥️ Admin Panel
    └── 🤖 API Client
         ↓
🌐 WebSocket Connection Manager
    ├── 🔐 Authentication
    ├── 📊 Connection Pool
    ├── 🎯 Channel Management
    └── 💾 Message Routing
         ↓
🎯 Event Handlers
    ├── 💬 Chat Messages
    ├── 📊 Live Updates
    ├── 🔔 Notifications
    └── 📈 Real-time Data
         ↓
📊 Data Sources
    ├── 💾 Database Changes
    ├── 🌐 External APIs
    ├── 📈 System Metrics
    └── 👥 User Actions
         ↓
📡 Real-time Broadcast
    └── 📱 All Connected Clients
</div></code></pre>
<h3 id="%F0%9F%9B%A0%EF%B8%8F-advanced-websocket-implementation">🛠️ Advanced WebSocket Implementation</h3>
<h4 id="%F0%9F%94%97-connection-manager-with-channels">🔗 Connection Manager with Channels</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Dict, List, Set, Any, Optional
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> WebSocket, WebSocketDisconnect
<span class="hljs-keyword">from</span> enum <span class="hljs-keyword">import</span> Enum
<span class="hljs-keyword">import</span> logging

logger = logging.getLogger(__name__)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MessageType</span><span class="hljs-params">(str, Enum)</span>:</span>
    <span class="hljs-string">"""📋 WebSocket message types"""</span>
    CONNECT = <span class="hljs-string">"connect"</span>
    DISCONNECT = <span class="hljs-string">"disconnect"</span>
    CHAT = <span class="hljs-string">"chat"</span>
    NOTIFICATION = <span class="hljs-string">"notification"</span>
    SYSTEM_UPDATE = <span class="hljs-string">"system_update"</span>
    USER_ACTIVITY = <span class="hljs-string">"user_activity"</span>
    DATA_UPDATE = <span class="hljs-string">"data_update"</span>
    ERROR = <span class="hljs-string">"error"</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChannelType</span><span class="hljs-params">(str, Enum)</span>:</span>
    <span class="hljs-string">"""🎯 WebSocket channel types"""</span>
    GLOBAL = <span class="hljs-string">"global"</span>          <span class="hljs-comment"># All users</span>
    USER = <span class="hljs-string">"user"</span>              <span class="hljs-comment"># Specific user</span>
    ADMIN = <span class="hljs-string">"admin"</span>            <span class="hljs-comment"># Admin users only</span>
    DASHBOARD = <span class="hljs-string">"dashboard"</span>    <span class="hljs-comment"># Dashboard updates</span>
    CHAT = <span class="hljs-string">"chat"</span>              <span class="hljs-comment"># Chat rooms</span>
    NOTIFICATIONS = <span class="hljs-string">"notifications"</span>  <span class="hljs-comment"># System notifications</span>

<span class="hljs-meta">@dataclass</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSocketConnection</span>:</span>
    <span class="hljs-string">"""🔗 Individual WebSocket connection info"""</span>
    websocket: WebSocket
    user_id: Optional[str] = <span class="hljs-literal">None</span>
    username: Optional[str] = <span class="hljs-literal">None</span>
    channels: Set[str] = field(default_factory=set)
    connected_at: datetime = field(default_factory=datetime.utcnow)
    last_ping: Optional[datetime] = <span class="hljs-literal">None</span>
    metadata: Dict[str, Any] = field(default_factory=dict)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdvancedConnectionManager</span>:</span>
    <span class="hljs-string">"""
    🔗 Advanced WebSocket connection manager
    
    Features:
    🎯 Channel-based messaging
    🔐 Authentication support
    📊 Connection analytics
    💾 Message persistence
    🔔 Automated notifications
    📈 Real-time metrics
    """</span>
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># 🔗 Active connections</span>
        self.connections: Dict[str, WebSocketConnection] = {}
        
        <span class="hljs-comment"># 🎯 Channel management</span>
        self.channels: Dict[str, Set[str]] = {}  <span class="hljs-comment"># channel -&gt; connection_ids</span>
        
        <span class="hljs-comment"># 📊 Connection analytics</span>
        self.connection_stats = {
            <span class="hljs-string">"total_connections"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"current_connections"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"messages_sent"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"messages_received"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"peak_connections"</span>: <span class="hljs-number">0</span>
        }
        
        <span class="hljs-comment"># 🔔 Message queue for offline users</span>
        self.offline_messages: Dict[str, List[Dict[str, Any]]] = {}
    
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">connect</span><span class="hljs-params">(
        self,
        websocket: WebSocket,
        connection_id: str,
        user_id: str = None,
        username: str = None,
        channels: List[str] = None
    )</span>:</span>
        <span class="hljs-string">"""🔗 Handle new WebSocket connection"""</span>
        
        <span class="hljs-keyword">await</span> websocket.accept()
        
        connection = WebSocketConnection(
            websocket=websocket,
            user_id=user_id,
            username=username <span class="hljs-keyword">or</span> <span class="hljs-string">f"User_<span class="hljs-subst">{connection_id[:<span class="hljs-number">8</span>]}</span>"</span>,
            channels=set(channels <span class="hljs-keyword">or</span> [<span class="hljs-string">"global"</span>])
        )
        
        self.connections[connection_id] = connection
        
        <span class="hljs-comment"># 📊 Add to channels</span>
        <span class="hljs-keyword">for</span> channel <span class="hljs-keyword">in</span> connection.channels:
            <span class="hljs-keyword">if</span> channel <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.channels:
                self.channels[channel] = set()
            self.channels[channel].add(connection_id)
        
        <span class="hljs-comment"># 📈 Update statistics</span>
        self.connection_stats[<span class="hljs-string">"total_connections"</span>] += <span class="hljs-number">1</span>
        self.connection_stats[<span class="hljs-string">"current_connections"</span>] += <span class="hljs-number">1</span>
        self.connection_stats[<span class="hljs-string">"peak_connections"</span>] = max(
            self.connection_stats[<span class="hljs-string">"peak_connections"</span>],
            self.connection_stats[<span class="hljs-string">"current_connections"</span>]
        )
        
        <span class="hljs-comment"># 📢 Notify about new connection</span>
        <span class="hljs-keyword">await</span> self.broadcast_to_channel(
            <span class="hljs-string">"global"</span>,
            {
                <span class="hljs-string">"type"</span>: MessageType.USER_ACTIVITY,
                <span class="hljs-string">"message"</span>: <span class="hljs-string">f"👋 <span class="hljs-subst">{connection.username}</span> joined"</span>,
                <span class="hljs-string">"user_id"</span>: user_id,
                <span class="hljs-string">"username"</span>: connection.username,
                <span class="hljs-string">"timestamp"</span>: datetime.utcnow().isoformat()
            },
            exclude=[connection_id]
        )
        
        <span class="hljs-comment"># 📧 Send offline messages if any</span>
        <span class="hljs-keyword">if</span> user_id <span class="hljs-keyword">and</span> user_id <span class="hljs-keyword">in</span> self.offline_messages:
            <span class="hljs-keyword">for</span> message <span class="hljs-keyword">in</span> self.offline_messages[user_id]:
                <span class="hljs-keyword">await</span> self.send_personal_message(connection_id, message)
            <span class="hljs-keyword">del</span> self.offline_messages[user_id]
        
        logger.info(<span class="hljs-string">f"🔗 WebSocket connected: <span class="hljs-subst">{connection_id}</span> (<span class="hljs-subst">{connection.username}</span>)"</span>)
    
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">disconnect</span><span class="hljs-params">(self, connection_id: str)</span>:</span>
        <span class="hljs-string">"""🔌 Handle WebSocket disconnection"""</span>
        
        connection = self.connections.get(connection_id)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> connection:
            <span class="hljs-keyword">return</span>
        
        <span class="hljs-comment"># 📊 Remove from channels</span>
        <span class="hljs-keyword">for</span> channel <span class="hljs-keyword">in</span> connection.channels:
            <span class="hljs-keyword">if</span> channel <span class="hljs-keyword">in</span> self.channels:
                self.channels[channel].discard(connection_id)
                <span class="hljs-comment"># Clean up empty channels</span>
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.channels[channel]:
                    <span class="hljs-keyword">del</span> self.channels[channel]
        
        <span class="hljs-comment"># 📈 Update statistics</span>
        self.connection_stats[<span class="hljs-string">"current_connections"</span>] -= <span class="hljs-number">1</span>
        
        <span class="hljs-comment"># 📢 Notify about disconnection</span>
        <span class="hljs-keyword">await</span> self.broadcast_to_channel(
            <span class="hljs-string">"global"</span>,
            {
                <span class="hljs-string">"type"</span>: MessageType.USER_ACTIVITY,
                <span class="hljs-string">"message"</span>: <span class="hljs-string">f"👋 <span class="hljs-subst">{connection.username}</span> left"</span>,
                <span class="hljs-string">"user_id"</span>: connection.user_id,
                <span class="hljs-string">"username"</span>: connection.username,
                <span class="hljs-string">"timestamp"</span>: datetime.utcnow().isoformat()
            },
            exclude=[connection_id]
        )
        
        <span class="hljs-comment"># 🗑️ Clean up connection</span>
        <span class="hljs-keyword">del</span> self.connections[connection_id]
        
        logger.info(<span class="hljs-string">f"🔌 WebSocket disconnected: <span class="hljs-subst">{connection_id}</span> (<span class="hljs-subst">{connection.username}</span>)"</span>)
    
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_personal_message</span><span class="hljs-params">(self, connection_id: str, message: Dict[str, Any])</span>:</span>
        <span class="hljs-string">"""📧 Send message to specific connection"""</span>
        
        connection = self.connections.get(connection_id)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> connection:
            logger.warning(<span class="hljs-string">f"📧 Connection <span class="hljs-subst">{connection_id}</span> not found for personal message"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">await</span> connection.websocket.send_text(json.dumps(message))
            self.connection_stats[<span class="hljs-string">"messages_sent"</span>] += <span class="hljs-number">1</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
            
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            logger.error(<span class="hljs-string">f"❌ Failed to send personal message to <span class="hljs-subst">{connection_id}</span>: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-comment"># Connection might be broken, disconnect it</span>
            <span class="hljs-keyword">await</span> self.disconnect(connection_id)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">broadcast_to_channel</span><span class="hljs-params">(
        self,
        channel: str,
        message: Dict[str, Any],
        exclude: List[str] = None
    )</span>:</span>
        <span class="hljs-string">"""📢 Broadcast message to all connections in a channel"""</span>
        
        <span class="hljs-keyword">if</span> channel <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.channels:
            logger.warning(<span class="hljs-string">f"📢 Channel <span class="hljs-subst">{channel}</span> not found"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
        
        exclude = exclude <span class="hljs-keyword">or</span> []
        sent_count = <span class="hljs-number">0</span>
        failed_connections = []
        
        <span class="hljs-comment"># 📡 Send to all connections in channel</span>
        <span class="hljs-keyword">for</span> connection_id <span class="hljs-keyword">in</span> self.channels[channel].copy():
            <span class="hljs-keyword">if</span> connection_id <span class="hljs-keyword">in</span> exclude:
                <span class="hljs-keyword">continue</span>
                
            success = <span class="hljs-keyword">await</span> self.send_personal_message(connection_id, message)
            <span class="hljs-keyword">if</span> success:
                sent_count += <span class="hljs-number">1</span>
            <span class="hljs-keyword">else</span>:
                failed_connections.append(connection_id)
        
        <span class="hljs-comment"># 🧹 Clean up failed connections</span>
        <span class="hljs-keyword">for</span> failed_id <span class="hljs-keyword">in</span> failed_connections:
            <span class="hljs-keyword">await</span> self.disconnect(failed_id)
        
        logger.debug(<span class="hljs-string">f"📢 Broadcast to <span class="hljs-subst">{channel}</span>: <span class="hljs-subst">{sent_count}</span> messages sent"</span>)
        <span class="hljs-keyword">return</span> sent_count
    
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">broadcast_to_all</span><span class="hljs-params">(self, message: Dict[str, Any], exclude: List[str] = None)</span>:</span>
        <span class="hljs-string">"""📢 Broadcast message to all connections"""</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> self.broadcast_to_channel(<span class="hljs-string">"global"</span>, message, exclude)
    
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_to_user</span><span class="hljs-params">(self, user_id: str, message: Dict[str, Any])</span>:</span>
        <span class="hljs-string">"""👤 Send message to specific user (all their connections)"""</span>
        
        sent_count = <span class="hljs-number">0</span>
        
        <span class="hljs-keyword">for</span> connection_id, connection <span class="hljs-keyword">in</span> self.connections.items():
            <span class="hljs-keyword">if</span> connection.user_id == user_id:
                success = <span class="hljs-keyword">await</span> self.send_personal_message(connection_id, message)
                <span class="hljs-keyword">if</span> success:
                    sent_count += <span class="hljs-number">1</span>
        
        <span class="hljs-comment"># 💾 Store message for offline user if no active connections</span>
        <span class="hljs-keyword">if</span> sent_count == <span class="hljs-number">0</span>:
            <span class="hljs-keyword">if</span> user_id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.offline_messages:
                self.offline_messages[user_id] = []
            self.offline_messages[user_id].append(message)
            
            <span class="hljs-comment"># 🧹 Limit offline message queue size</span>
            <span class="hljs-keyword">if</span> len(self.offline_messages[user_id]) &gt; <span class="hljs-number">100</span>:
                self.offline_messages[user_id] = self.offline_messages[user_id][<span class="hljs-number">-100</span>:]
        
        <span class="hljs-keyword">return</span> sent_count
    
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">join_channel</span><span class="hljs-params">(self, connection_id: str, channel: str)</span>:</span>
        <span class="hljs-string">"""🔗 Add connection to a channel"""</span>
        
        connection = self.connections.get(connection_id)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> connection:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        
        connection.channels.add(channel)
        
        <span class="hljs-keyword">if</span> channel <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.channels:
            self.channels[channel] = set()
        self.channels[channel].add(connection_id)
        
        logger.info(<span class="hljs-string">f"🔗 Connection <span class="hljs-subst">{connection_id}</span> joined channel <span class="hljs-subst">{channel}</span>"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">leave_channel</span><span class="hljs-params">(self, connection_id: str, channel: str)</span>:</span>
        <span class="hljs-string">"""🔌 Remove connection from a channel"""</span>
        
        connection = self.connections.get(connection_id)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> connection:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        
        connection.channels.discard(channel)
        
        <span class="hljs-keyword">if</span> channel <span class="hljs-keyword">in</span> self.channels:
            self.channels[channel].discard(connection_id)
            <span class="hljs-comment"># Clean up empty channel</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.channels[channel]:
                <span class="hljs-keyword">del</span> self.channels[channel]
        
        logger.info(<span class="hljs-string">f"🔌 Connection <span class="hljs-subst">{connection_id}</span> left channel <span class="hljs-subst">{channel}</span>"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_connection_info</span><span class="hljs-params">(self, connection_id: str)</span> -&gt; Optional[Dict[str, Any]]:</span>
        <span class="hljs-string">"""ℹ️ Get connection information"""</span>
        
        connection = self.connections.get(connection_id)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> connection:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"connection_id"</span>: connection_id,
            <span class="hljs-string">"user_id"</span>: connection.user_id,
            <span class="hljs-string">"username"</span>: connection.username,
            <span class="hljs-string">"channels"</span>: list(connection.channels),
            <span class="hljs-string">"connected_at"</span>: connection.connected_at.isoformat(),
            <span class="hljs-string">"last_ping"</span>: connection.last_ping.isoformat() <span class="hljs-keyword">if</span> connection.last_ping <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>,
            <span class="hljs-string">"metadata"</span>: connection.metadata
        }
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_statistics</span><span class="hljs-params">(self)</span> -&gt; Dict[str, Any]:</span>
        <span class="hljs-string">"""📊 Get comprehensive connection statistics"""</span>
        
        <span class="hljs-keyword">return</span> {
            **self.connection_stats,
            <span class="hljs-string">"active_connections"</span>: list(self.connections.keys()),
            <span class="hljs-string">"active_channels"</span>: {
                channel: len(connections) 
                <span class="hljs-keyword">for</span> channel, connections <span class="hljs-keyword">in</span> self.channels.items()
            },
            <span class="hljs-string">"offline_message_queues"</span>: {
                user_id: len(messages)
                <span class="hljs-keyword">for</span> user_id, messages <span class="hljs-keyword">in</span> self.offline_messages.items()
            }
        }

<span class="hljs-comment"># Global connection manager</span>
connection_manager = AdvancedConnectionManager()
</div></code></pre>
<h4 id="%F0%9F%92%AC-real-time-chat-system">💬 Real-time Chat System</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Dict, List, Any

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChatRoom</span>:</span>
    <span class="hljs-string">"""💬 Individual chat room with advanced features"""</span>
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, room_id: str, name: str, created_by: str)</span>:</span>
        self.room_id = room_id
        self.name = name
        self.created_by = created_by
        self.created_at = datetime.utcnow()
        self.members: Set[str] = {created_by}
        self.message_history: List[Dict[str, Any]] = []
        self.is_active = <span class="hljs-literal">True</span>
        
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_member</span><span class="hljs-params">(self, user_id: str)</span>:</span>
        <span class="hljs-string">"""👥 Add member to chat room"""</span>
        self.members.add(user_id)
        
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">remove_member</span><span class="hljs-params">(self, user_id: str)</span>:</span>
        <span class="hljs-string">"""👤 Remove member from chat room"""</span>
        self.members.discard(user_id)
        
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_message</span><span class="hljs-params">(self, message: Dict[str, Any])</span>:</span>
        <span class="hljs-string">"""📝 Add message to chat history"""</span>
        self.message_history.append(message)
        <span class="hljs-comment"># Keep only last 1000 messages</span>
        <span class="hljs-keyword">if</span> len(self.message_history) &gt; <span class="hljs-number">1000</span>:
            self.message_history = self.message_history[<span class="hljs-number">-1000</span>:]

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChatManager</span>:</span>
    <span class="hljs-string">"""
    💬 Advanced chat management system
    
    Features:
    🏠 Multiple chat rooms
    👥 User management
    📝 Message history
    🔔 Typing indicators
    📎 File attachments
    🔍 Message search
    """</span>
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
        self.rooms: Dict[str, ChatRoom] = {}
        self.user_rooms: Dict[str, Set[str]] = {}  <span class="hljs-comment"># user_id -&gt; room_ids</span>
        
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_room</span><span class="hljs-params">(self, room_name: str, created_by: str)</span> -&gt; str:</span>
        <span class="hljs-string">"""🏠 Create new chat room"""</span>
        room_id = str(uuid.uuid4())
        
        room = ChatRoom(room_id, room_name, created_by)
        self.rooms[room_id] = room
        
        <span class="hljs-comment"># Add creator to user rooms</span>
        <span class="hljs-keyword">if</span> created_by <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.user_rooms:
            self.user_rooms[created_by] = set()
        self.user_rooms[created_by].add(room_id)
        
        logger.info(<span class="hljs-string">f"🏠 Created chat room: <span class="hljs-subst">{room_name}</span> (<span class="hljs-subst">{room_id}</span>)"</span>)
        <span class="hljs-keyword">return</span> room_id
    
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">join_room</span><span class="hljs-params">(self, room_id: str, user_id: str, username: str)</span> -&gt; bool:</span>
        <span class="hljs-string">"""🔗 User joins chat room"""</span>
        room = self.rooms.get(room_id)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> room <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> room.is_active:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        
        room.add_member(user_id)
        
        <span class="hljs-comment"># Add room to user's rooms</span>
        <span class="hljs-keyword">if</span> user_id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.user_rooms:
            self.user_rooms[user_id] = set()
        self.user_rooms[user_id].add(room_id)
        
        <span class="hljs-comment"># Join WebSocket channel</span>
        <span class="hljs-keyword">for</span> connection_id, connection <span class="hljs-keyword">in</span> connection_manager.connections.items():
            <span class="hljs-keyword">if</span> connection.user_id == user_id:
                <span class="hljs-keyword">await</span> connection_manager.join_channel(connection_id, <span class="hljs-string">f"chat_<span class="hljs-subst">{room_id}</span>"</span>)
        
        <span class="hljs-comment"># Notify room members</span>
        <span class="hljs-keyword">await</span> connection_manager.broadcast_to_channel(
            <span class="hljs-string">f"chat_<span class="hljs-subst">{room_id}</span>"</span>,
            {
                <span class="hljs-string">"type"</span>: MessageType.USER_ACTIVITY,
                <span class="hljs-string">"room_id"</span>: room_id,
                <span class="hljs-string">"message"</span>: <span class="hljs-string">f"👋 <span class="hljs-subst">{username}</span> joined the room"</span>,
                <span class="hljs-string">"user_id"</span>: user_id,
                <span class="hljs-string">"username"</span>: username,
                <span class="hljs-string">"timestamp"</span>: datetime.utcnow().isoformat()
            }
        )
        
        logger.info(<span class="hljs-string">f"🔗 User <span class="hljs-subst">{username}</span> joined room <span class="hljs-subst">{room_id}</span>"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">leave_room</span><span class="hljs-params">(self, room_id: str, user_id: str, username: str)</span> -&gt; bool:</span>
        <span class="hljs-string">"""🔌 User leaves chat room"""</span>
        room = self.rooms.get(room_id)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> room:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        
        room.remove_member(user_id)
        
        <span class="hljs-comment"># Remove room from user's rooms</span>
        <span class="hljs-keyword">if</span> user_id <span class="hljs-keyword">in</span> self.user_rooms:
            self.user_rooms[user_id].discard(room_id)
        
        <span class="hljs-comment"># Leave WebSocket channel</span>
        <span class="hljs-keyword">for</span> connection_id, connection <span class="hljs-keyword">in</span> connection_manager.connections.items():
            <span class="hljs-keyword">if</span> connection.user_id == user_id:
                <span class="hljs-keyword">await</span> connection_manager.leave_channel(connection_id, <span class="hljs-string">f"chat_<span class="hljs-subst">{room_id}</span>"</span>)
        
        <span class="hljs-comment"># Notify room members</span>
        <span class="hljs-keyword">await</span> connection_manager.broadcast_to_channel(
            <span class="hljs-string">f"chat_<span class="hljs-subst">{room_id}</span>"</span>,
            {
                <span class="hljs-string">"type"</span>: MessageType.USER_ACTIVITY,
                <span class="hljs-string">"room_id"</span>: room_id,
                <span class="hljs-string">"message"</span>: <span class="hljs-string">f"👋 <span class="hljs-subst">{username}</span> left the room"</span>,
                <span class="hljs-string">"user_id"</span>: user_id,
                <span class="hljs-string">"username"</span>: username,
                <span class="hljs-string">"timestamp"</span>: datetime.utcnow().isoformat()
            }
        )
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_message</span><span class="hljs-params">(
        self,
        room_id: str,
        user_id: str,
        username: str,
        content: str,
        message_type: str = <span class="hljs-string">"text"</span>
    )</span> -&gt; Dict[str, Any]:</span>
        <span class="hljs-string">"""📝 Send message to chat room"""</span>
        room = self.rooms.get(room_id)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> room <span class="hljs-keyword">or</span> user_id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> room.members:
            <span class="hljs-keyword">return</span> {<span class="hljs-string">"error"</span>: <span class="hljs-string">"Room not found or user not in room"</span>}
        
        message = {
            <span class="hljs-string">"message_id"</span>: str(uuid.uuid4()),
            <span class="hljs-string">"room_id"</span>: room_id,
            <span class="hljs-string">"user_id"</span>: user_id,
            <span class="hljs-string">"username"</span>: username,
            <span class="hljs-string">"content"</span>: content,
            <span class="hljs-string">"message_type"</span>: message_type,
            <span class="hljs-string">"timestamp"</span>: datetime.utcnow().isoformat(),
            <span class="hljs-string">"type"</span>: MessageType.CHAT
        }
        
        <span class="hljs-comment"># Add to room history</span>
        room.add_message(message)
        
        <span class="hljs-comment"># Broadcast to room members</span>
        <span class="hljs-keyword">await</span> connection_manager.broadcast_to_channel(<span class="hljs-string">f"chat_<span class="hljs-subst">{room_id}</span>"</span>, message)
        
        logger.info(<span class="hljs-string">f"📝 Message sent in room <span class="hljs-subst">{room_id}</span> by <span class="hljs-subst">{username}</span>"</span>)
        <span class="hljs-keyword">return</span> message
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_room_info</span><span class="hljs-params">(self, room_id: str)</span> -&gt; Optional[Dict[str, Any]]:</span>
        <span class="hljs-string">"""ℹ️ Get chat room information"""</span>
        room = self.rooms.get(room_id)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> room:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"room_id"</span>: room.room_id,
            <span class="hljs-string">"name"</span>: room.name,
            <span class="hljs-string">"created_by"</span>: room.created_by,
            <span class="hljs-string">"created_at"</span>: room.created_at.isoformat(),
            <span class="hljs-string">"member_count"</span>: len(room.members),
            <span class="hljs-string">"members"</span>: list(room.members),
            <span class="hljs-string">"message_count"</span>: len(room.message_history),
            <span class="hljs-string">"is_active"</span>: room.is_active,
            <span class="hljs-string">"recent_messages"</span>: room.message_history[<span class="hljs-number">-10</span>:]  <span class="hljs-comment"># Last 10 messages</span>
        }
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_user_rooms</span><span class="hljs-params">(self, user_id: str)</span> -&gt; List[Dict[str, Any]]:</span>
        <span class="hljs-string">"""📋 Get all rooms for a user"""</span>
        user_room_ids = self.user_rooms.get(user_id, set())
        
        <span class="hljs-keyword">return</span> [
            self.get_room_info(room_id)
            <span class="hljs-keyword">for</span> room_id <span class="hljs-keyword">in</span> user_room_ids
            <span class="hljs-keyword">if</span> room_id <span class="hljs-keyword">in</span> self.rooms
        ]

<span class="hljs-comment"># Global chat manager</span>
chat_manager = ChatManager()

<span class="hljs-meta">@app.websocket("/ws/chat/{room_id}")</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">websocket_chat_endpoint</span><span class="hljs-params">(websocket: WebSocket, room_id: str, user_id: str = None, username: str = None)</span>:</span>
    <span class="hljs-string">"""
    💬 WebSocket endpoint for chat functionality
    
    Use Cases:
    👥 Team collaboration
    💬 Customer support
    🎯 Community discussions
    📞 Video call coordination
    🎮 Gaming chat
    """</span>
    connection_id = str(uuid.uuid4())
    
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># Connect to WebSocket</span>
        <span class="hljs-keyword">await</span> connection_manager.connect(
            websocket=websocket,
            connection_id=connection_id,
            user_id=user_id,
            username=username,
            channels=[<span class="hljs-string">f"chat_<span class="hljs-subst">{room_id}</span>"</span>]
        )
        
        <span class="hljs-comment"># Join chat room</span>
        <span class="hljs-keyword">await</span> chat_manager.join_room(room_id, user_id, username)
        
        <span class="hljs-comment"># Send room info</span>
        room_info = chat_manager.get_room_info(room_id)
        <span class="hljs-keyword">await</span> connection_manager.send_personal_message(connection_id, {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"room_info"</span>,
            <span class="hljs-string">"room"</span>: room_info
        })
        
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-comment"># Receive message from client</span>
            data = <span class="hljs-keyword">await</span> websocket.receive_text()
            message_data = json.loads(data)
            
            message_type = message_data.get(<span class="hljs-string">"type"</span>)
            
            <span class="hljs-keyword">if</span> message_type == <span class="hljs-string">"chat_message"</span>:
                <span class="hljs-comment"># Send chat message</span>
                <span class="hljs-keyword">await</span> chat_manager.send_message(
                    room_id=room_id,
                    user_id=user_id,
                    username=username,
                    content=message_data.get(<span class="hljs-string">"content"</span>, <span class="hljs-string">""</span>),
                    message_type=message_data.get(<span class="hljs-string">"message_type"</span>, <span class="hljs-string">"text"</span>)
                )
            
            <span class="hljs-keyword">elif</span> message_type == <span class="hljs-string">"typing"</span>:
                <span class="hljs-comment"># Typing indicator</span>
                <span class="hljs-keyword">await</span> connection_manager.broadcast_to_channel(
                    <span class="hljs-string">f"chat_<span class="hljs-subst">{room_id}</span>"</span>,
                    {
                        <span class="hljs-string">"type"</span>: <span class="hljs-string">"typing"</span>,
                        <span class="hljs-string">"user_id"</span>: user_id,
                        <span class="hljs-string">"username"</span>: username,
                        <span class="hljs-string">"is_typing"</span>: message_data.get(<span class="hljs-string">"is_typing"</span>, <span class="hljs-literal">False</span>)
                    },
                    exclude=[connection_id]
                )
            
            <span class="hljs-keyword">elif</span> message_type == <span class="hljs-string">"ping"</span>:
                <span class="hljs-comment"># Handle ping for connection health</span>
                connection_manager.connections[connection_id].last_ping = datetime.utcnow()
                <span class="hljs-keyword">await</span> connection_manager.send_personal_message(connection_id, {<span class="hljs-string">"type"</span>: <span class="hljs-string">"pong"</span>})
    
    <span class="hljs-keyword">except</span> WebSocketDisconnect:
        <span class="hljs-comment"># Leave chat room</span>
        <span class="hljs-keyword">if</span> user_id <span class="hljs-keyword">and</span> username:
            <span class="hljs-keyword">await</span> chat_manager.leave_room(room_id, user_id, username)
        
        <span class="hljs-comment"># Disconnect from WebSocket</span>
        <span class="hljs-keyword">await</span> connection_manager.disconnect(connection_id)
</div></code></pre>
<h4 id="%F0%9F%93%8A-real-time-dashboard-updates">📊 Real-time Dashboard Updates</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">import</span> random

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DashboardUpdates</span>:</span>
    <span class="hljs-string">"""
    📊 Real-time dashboard update system
    
    Features:
    📈 Live metrics
    🔄 Auto-refresh data
    📊 Performance

&lt;div style="text-align: center"&gt;⁂&lt;/div&gt;

[^1]: paste.txt```

</span></div></code></pre>

</body>
</html>
