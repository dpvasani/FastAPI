
# âš¡ FastAPI Other Concepts Overview

---

## ğŸš¨ 1. Error Handling in FastAPI

### âœ… Built-in Exception Handling

FastAPI provides built-in exceptions like `HTTPException`.

```python
from fastapi import FastAPI, HTTPException

app = FastAPI()

@app.get("/item/{item_id}")
def read_item(item_id: int):
    if item_id == 0:
        raise HTTPException(status_code=404, detail="Item not found ğŸš«")
    return {"item_id": item_id}
```

### âœ… Custom Exception Handling

```python
from fastapi import Request
from fastapi.responses import JSONResponse
from fastapi.exceptions import RequestValidationError

@app.exception_handler(RequestValidationError)
async def validation_exception_handler(request: Request, exc: RequestValidationError):
    return JSONResponse(
        status_code=422,
        content={"message": "Validation failed ğŸ˜µ", "details": exc.errors()},
    )
```

### ğŸ” Best Practices

* Use descriptive `detail` in errors.
* Handle common errors (e.g., 404, 400, 500) globally.
* Avoid leaking sensitive info in error messages.

---

## ğŸ“¬ 2. Custom Responses

### âœ… Using `JSONResponse`, `HTMLResponse`, `PlainTextResponse`

```python
from fastapi.responses import JSONResponse, HTMLResponse, PlainTextResponse

@app.get("/json")
def custom_json():
    return JSONResponse(content={"msg": "Hello JSON ğŸ‘‹"})

@app.get("/html")
def custom_html():
    return HTMLResponse(content="<h1>Hello HTML ğŸ§‘â€ğŸ’»</h1>")

@app.get("/text")
def custom_text():
    return PlainTextResponse(content="Hello Text ğŸ“")
```

### ğŸ” Best Practices

* Use appropriate content types.
* Set custom status codes when needed (`status_code=201`).
* Always document your custom responses using `@app.get(..., responses={})`.

---

## ğŸ§¾ 3. Headers in FastAPI

### âœ… Accessing Request Headers

```python
from fastapi import Header

@app.get("/headers/")
def read_headers(user_agent: str = Header(...)):
    return {"User-Agent": user_agent}
```

### âœ… Setting Response Headers

```python
from fastapi.responses import Response

@app.get("/set-header/")
def custom_header(response: Response):
    response.headers["X-Custom-Header"] = "FastAPI â¤ï¸"
    return {"message": "Custom header sent!"}
```

### ğŸ” Best Practices

* Avoid sensitive data in headers.
* Use standard naming conventions (`X-Custom-Header`, etc).

---

## ğŸª 4. Cookies in FastAPI

### âœ… Setting Cookies

```python
@app.get("/set-cookie/")
def set_cookie(response: Response):
    response.set_cookie(key="session_id", value="abc123", httponly=True)
    return {"message": "ğŸª Cookie set!"}
```

### âœ… Reading Cookies

```python
from fastapi import Cookie

@app.get("/get-cookie/")
def get_cookie(session_id: str = Cookie(None)):
    return {"session_id": session_id}
```

### ğŸ” Best Practices

* Use `httponly=True` to prevent JavaScript access.
* Set `secure=True` for HTTPS.
* Prefer JWTs or sessions over plain cookies.

---

## ğŸ§¾ 5. Form Data Handling

### âœ… Receiving Form Data

```python
from fastapi import Form

@app.post("/login/")
def login(username: str = Form(...), password: str = Form(...)):
    return {"username": username, "message": "Login form submitted âœ…"}
```

### ğŸ” Best Practices

* Always use `Form` for `x-www-form-urlencoded` POST data.
* Use HTTPS to protect credentials.
* Consider CSRF protection for forms in production apps.

---

## ğŸ”„ 6. CORS (Cross-Origin Resource Sharing)

### âœ… Enable CORS Middleware

```python
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI()

origins = [
    "http://localhost:3000",  # React frontend
    "https://myapp.com",      # Production domain
]

app.add_middleware(
    CORSMiddleware,
    allow_origins=origins,          # or ["*"] for all
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### ğŸ” Best Practices

* In production, restrict `allow_origins` to known domains.
* Donâ€™t use `["*"]` for `allow_credentials=True` (violates spec).
* Allow only necessary headers and methods.

---

## ğŸ” Flow Overview Diagram (Text-Based)

```
Frontend ğŸ”„ âŸ¶ CORS Middleware ğŸŒ
          â¬‡
     FastAPI Endpoint ğŸ§ 
          â¬‡
   - Read Headers/Cookies
   - Parse Form Data
   - Handle Errors (Custom/Built-in)
   - Generate Response
          â¬‡
    Response with Headers/Cookies ğŸ”™
```

---

## ğŸ“š Summary Table

| Feature          | Module                                 | Key Functionality                     |
| ---------------- | -------------------------------------- | ------------------------------------- |
| Error Handling   | `HTTPException`, `exception_handler()` | Global & custom error responses       |
| Custom Responses | `JSONResponse`, `HTMLResponse`         | Control response format and headers   |
| Headers          | `Header`, `Response.headers`           | Read and write HTTP headers           |
| Cookies          | `Cookie`, `response.set_cookie()`      | Store sessions or metadata in cookies |
| Form Data        | `Form`                                 | Parse form submissions                |
| CORS             | `CORSMiddleware`                       | Secure frontend-backend communication |

---

## âœ… Final Best Practices Checklist

* [x] ğŸ” Handle all exceptions gracefully.
* [x] ğŸ’¬ Provide meaningful error messages.
* [x] ğŸ“¦ Use correct response types.
* [x] ğŸ§ Handle cookies with security flags (`HttpOnly`, `Secure`).
* [x] ğŸ“¨ Use CORS to secure frontend-backend interaction.
* [x] ğŸ§¾ Validate all form and query data.
---

# ğŸŒ HTTP Status Codes Cheat Sheet with FastAPI ğŸ’¡

---

## ğŸ”µ 1xx â€” **INFORMATIONAL RESPONSES**

> âœ… Request received, continuing process.

| Code | Meaning             | Description                                       |
| ---- | ------------------- | ------------------------------------------------- |
| 100  | Continue            | Client should continue the request.               |
| 101  | Switching Protocols | Server agrees to change protocols.                |
| 102  | Processing (WebDAV) | Server has accepted request but not completed it. |

ğŸ§  **FastAPI Tip**: Rarely used directly.

---

## ğŸŸ¢ 2xx â€” **SUCCESSFUL RESPONSES**

> ğŸ‰ The request was successfully received, understood, and accepted.

| Code | Meaning    | Description                                          |
| ---- | ---------- | ---------------------------------------------------- |
| 200  | OK         | Standard success for GET/PUT/DELETE.                 |
| 201  | Created    | Used after successful POST (e.g., resource created). |
| 202  | Accepted   | Request accepted but not completed yet.              |
| 204  | No Content | Success, but no response body (e.g., DELETE).        |

ğŸ“¦ **FastAPI Usage Example**:

```python
from fastapi import status

@app.post("/user", status_code=status.HTTP_201_CREATED)
def create_user(): 
    return {"message": "User created âœ…"}
```

---

## ğŸŸ¡ 3xx â€” **REDIRECTION MESSAGES**

> ğŸ” The client must take additional action.

| Code | Meaning            | Description                                |
| ---- | ------------------ | ------------------------------------------ |
| 301  | Moved Permanently  | Resource has a new URL. Update your links! |
| 302  | Found (Temporary)  | Temporarily moved to another URI.          |
| 304  | Not Modified       | Cached version can be used.                |
| 307  | Temporary Redirect | Like 302 but preserves method (POST/GET).  |
| 308  | Permanent Redirect | Like 301 but with method preservation.     |

ğŸ“¦ **FastAPI Example**:

```python
from fastapi.responses import RedirectResponse

@app.get("/old-link")
def old_link():
    return RedirectResponse(url="/new-link", status_code=307)
```

---

## ğŸ”´ 4xx â€” **CLIENT ERROR RESPONSES**

> ğŸš« The request contains bad syntax or cannot be fulfilled.

| Code | Meaning              | Description                                        |
| ---- | -------------------- | -------------------------------------------------- |
| 400  | Bad Request          | Client error (validation, format, etc).            |
| 401  | Unauthorized         | Authentication required.                           |
| 403  | Forbidden            | Authenticated but not allowed.                     |
| 404  | Not Found            | Resource doesnâ€™t exist.                            |
| 405  | Method Not Allowed   | Method (GET/POST/etc) not supported.               |
| 409  | Conflict             | Resource conflict (duplicate user, etc).           |
| 422  | Unprocessable Entity | Validation failed (e.g., FastAPI Pydantic errors). |
| 429  | Too Many Requests    | Rate limit hit.                                    |

ğŸ“¦ **FastAPI Example (422 Validation)**:

```python
from fastapi import HTTPException

@app.post("/login")
def login(username: str):
    if username == "":
        raise HTTPException(status_code=400, detail="Username is required ğŸš«")
```

---

## ğŸ”¥ 5xx â€” **SERVER ERROR RESPONSES**

> ğŸ’¥ The server failed to fulfill a valid request.

| Code | Meaning               | Description                                   |
| ---- | --------------------- | --------------------------------------------- |
| 500  | Internal Server Error | Generic server error.                         |
| 501  | Not Implemented       | Server doesn't support the requested feature. |
| 502  | Bad Gateway           | Invalid response from upstream server.        |
| 503  | Service Unavailable   | Server is down or overloaded.                 |
| 504  | Gateway Timeout       | Upstream server timed out.                    |

ğŸ“¦ **FastAPI Example (500 Error)**:

```python
@app.get("/crash")
def cause_crash():
    raise Exception("ğŸ’¥ Boom! Something broke.")
```

---

## ğŸš¦ Frequently Used HTTP Status Codes (Dev Cheatsheet)

| Type        | Codes                             | Description                     |
| ----------- | --------------------------------- | ------------------------------- |
| âœ… Success   | `200`, `201`, `204`               | Standard API success responses. |
| âŒ Client    | `400`, `401`, `403`, `404`, `422` | Validation and auth errors.     |
| ğŸ” Redirect | `301`, `302`, `307`, `308`        | Redirection flows.              |
| ğŸ§¯ Server   | `500`, `503`                      | Server crash or overload.       |

---

## ğŸ§ª FastAPI Usage Summary

âœ… You can use **status codes** directly via:

```python
from fastapi import status

@app.post("/resource", status_code=status.HTTP_201_CREATED)
def create():
    return {"msg": "Created"}
```

Or set manually in `JSONResponse`:

```python
from fastapi.responses import JSONResponse

return JSONResponse(
    status_code=404,
    content={"success": False, "message": "Not Found"}
)
```

---

## âœ… Best Practices Summary

* ğŸ¯ Always return proper status codes based on result.
* ğŸ”’ Use 401 for auth and 403 for access control.
* ğŸ“­ Use 422 for form/Pydantic validation errors.
* ğŸ’¬ Combine with `ApiResponse` or `ApiException` classes for consistent shape.
* ğŸš¨ Never expose stack traces or sensitive data in error responses in production.

---


## ğŸ§¯ 1. Error Handling in FastAPI

### ğŸ”¹ Custom Exception Classes

```python
# ğŸ‘¾ Define a custom exception
class StoryException(Exception):
    def __init__(self, name: str):
        self.name = name
```

### ğŸ”¹ Add Exception Handler

```python
from fastapi import Request
from fastapi.responses import JSONResponse

@app.exception_handler(StoryException)
async def story_exception_handler(request: Request, exc: StoryException):
    return JSONResponse(
        status_code=418,  # ğŸ”¥ Custom status code
        content={"detail": f"Oops! {exc.name} caused an issue â˜ ï¸"}
    )
```

### âœ… Usage

```python
@app.get("/story/")
def get_story(flag: bool = False):
    if not flag:
        raise StoryException(name="Missing Story Flag ğŸ³ï¸")
    return {"message": "Here's your story! ğŸ“–"}
```

---

## ğŸ“¦ 2. Custom Response

### ğŸ”¹ PlainTextResponse, HTMLResponse, FileResponse

```python
from fastapi.responses import HTMLResponse, PlainTextResponse

@app.get("/html", response_class=HTMLResponse)
def get_html():
    return "<h1>Hello ğŸŒ, this is raw HTML!</h1>"

@app.get("/text", response_class=PlainTextResponse)
def get_text():
    return "This is plain text âœ‰ï¸"
```

### ğŸ”¹ FileResponse (Download files)

```python
from fastapi.responses import FileResponse

@app.get("/download")
def download_file():
    return FileResponse("my_resume.pdf", media_type='application/pdf', filename="Resume.pdf")
```

---

## ğŸ§¾ 3. Headers

### ğŸ”¹ Access Headers from Request

```python
from fastapi import Request

@app.get("/headers/")
def read_headers(request: Request):
    headers = request.headers
    user_agent = headers.get("user-agent")
    return {"user_agent": user_agent}
```

### ğŸ”¹ Send Custom Headers in Response

```python
from fastapi.responses import JSONResponse

@app.get("/custom-header")
def custom_header():
    content = {"message": "Hello with headers!"}
    headers = {"X-Powered-By": "FastAPI âš¡"}
    return JSONResponse(content=content, headers=headers)
```

---

## ğŸª 4. Cookies

### ğŸ”¹ Set a Cookie ğŸª

```python
from fastapi import Response

@app.get("/set-cookie")
def set_cookie(response: Response):
    response.set_cookie(key="token", value="abc123")
    return {"message": "Cookie set âœ…"}
```

### ğŸ”¹ Read a Cookie

```python
from fastapi import Cookie

@app.get("/get-cookie")
def get_cookie(token: str = Cookie(default=None)):
    return {"your_token": token}
```

---

## ğŸ“ 5. Form Data

Used in **HTML forms** and `application/x-www-form-urlencoded` requests.

### ğŸ”¹ Form Parsing with `Form`

```python
from fastapi import Form

@app.post("/login")
def login(username: str = Form(...), password: str = Form(...)):
    return {"username": username, "message": "Logged in âœ…"}
```

ğŸ“Œ `Form(...)` means the field is **required**.

---

## ğŸ”„ 6. CORS (Cross-Origin Resource Sharing)

### ğŸ” What is CORS?

CORS controls who can access your API. Itâ€™s especially important when frontend (e.g., React) is hosted on a different domain than backend (FastAPI).

### ğŸ”¹ Enable CORS Middleware

```python
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # Or restrict to ["https://your-frontend.com"]
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

---

## ğŸ“ Summary Table

| Topic           | Use Case                               | Key Function/Class                             |
| --------------- | -------------------------------------- | ---------------------------------------------- |
| Error Handling  | Custom errors & responses              | `@app.exception_handler`                       |
| Custom Response | Return HTML, Text, Files               | `HTMLResponse`, `FileResponse`                 |
| Headers         | Metadata from client or sent by server | `request.headers`, `JSONResponse(headers=...)` |
| Cookies         | Session or auth tokens                 | `response.set_cookie()`, `Cookie()`            |
| Form Data       | HTML form submissions                  | `Form()`                                       |
| CORS            | Allow cross-origin frontend requests   | `CORSMiddleware`                               |

---
